#
# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
#  http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.
#
<!-- HTML header for doxygen 1.9.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ResilientDB: 01_terminal_ui__ink_components_</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen_html_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../logo.png"/></td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(1); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('dd/d7b/md__2github_2workspace_2ecosystem_2pocketflow_2docs_2Codex_201__terminal__ui____ink__components__.html','../../'); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">01_terminal_ui__ink_components_</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="autotoc_md1252"></a>
autotoc_md1252</h2>
<p>layout: default title: "Terminal UI (Ink Components)" parent: "Codex" </p>
<h2><a class="anchor" id="autotoc_md1253"></a>
nav_order: 1</h2>
<h1><a class="anchor" id="autotoc_md1254"></a>
Chapter 1: Terminal UI (Ink Components)</h1>
<p>Welcome to the Codex tutorial! We're excited to have you explore how Codex works under the hood. This first chapter dives into how Codex creates its chat interface right inside your terminal window.</p>
<h2><a class="anchor" id="autotoc_md1255"></a>
What's the Big Idea?</h2>
<p>Imagine you want <code>Codex</code> to write a simple script. You type something like <code>codex "write a python script that prints hello world"</code> into your terminal. How does Codex show you the conversation – your request, its response, maybe questions it asks, or commands it suggests running – all without opening a separate window? And how do you type your next message?</p>
<p>That's where the <b>Terminal UI</b> comes in. It's the system responsible for drawing the entire chat interface you see and interact with directly in your command line.</p>
<p>Think of it like the dashboard and controls of a car:</p>
<ul>
<li><b>Dashboard:</b> Displays information (like the chat history, AI messages, loading indicators).</li>
<li><b>Controls (Steering Wheel, Pedals):</b> Let you interact (like the input field where you type messages, or menus to approve commands).</li>
</ul>
<p>Just like the car's dashboard lets you see what the engine is doing and control it, the Terminal UI lets you see what the core <code>Codex</code> logic (the <a class="el" href="../../d0/dbd/md__2github_2workspace_2ecosystem_2pocketflow_2docs_2Codex_203__agent__loop.html">Agent Loop</a>) is doing and provide input to it.</p>
<h2><a class="anchor" id="autotoc_md1256"></a>
Key Concepts: Ink &amp; React</h2>
<p>How does Codex build this terminal interface? It uses two main technologies:</p>
<ol type="1">
<li><b>Ink:</b> This is a fantastic library that lets developers build command-line interfaces using <b>React</b>. If you know React for web development, Ink feels very similar, but instead of rendering buttons and divs in a browser, it renders text, boxes, and lists in your terminal.</li>
<li><b>React Components:</b> The UI is broken down into reusable pieces called React components. We have components for:<ul>
<li>Displaying individual messages (<code>TerminalChatResponseItem</code>).</li>
<li>Showing the whole conversation history (<code>MessageHistory</code>).</li>
<li>The text box where you type your input (<code>TerminalChatInput</code> / <code>TerminalChatNewInput</code>).</li>
<li>Prompts asking you to approve commands (<code>TerminalChatCommandReview</code>).</li>
<li>Spinners to show when Codex is thinking.</li>
</ul>
</li>
</ol>
<p>These components work together, managed by React, to create the dynamic interface you see.</p>
<h2><a class="anchor" id="autotoc_md1257"></a>
How You See It: Rendering the Chat</h2>
<p>When you run <code>Codex</code>, the main application component (<code>App</code> in <code>app.tsx</code>) kicks things off. It might first check if you're in a safe directory (like a Git repository) and ask for confirmation if not.</p>
<div class="fragment"><div class="line">// File: codex-cli/src/app.tsx (Simplified)</div>
<div class="line"> </div>
<div class="line">// ... imports ...</div>
<div class="line">import TerminalChat from &quot;./components/chat/terminal-chat&quot;;</div>
<div class="line">import { ConfirmInput } from &quot;@inkjs/ui&quot;;</div>
<div class="line">import { Box, Text, useApp } from &quot;ink&quot;;</div>
<div class="line">import React, { useState } from &quot;react&quot;;</div>
<div class="line"> </div>
<div class="line">export default function App({ /* ...props... */ }): JSX.Element {</div>
<div class="line">  const app = useApp();</div>
<div class="line">  const [accepted, setAccepted] = useState(/* ... */);</div>
<div class="line">  const inGitRepo = /* ... check if in git ... */;</div>
<div class="line"> </div>
<div class="line">  // If not in a git repo and not yet accepted, show a warning</div>
<div class="line">  if (!inGitRepo &amp;&amp; !accepted) {</div>
<div class="line">    return (</div>
<div class="line">      &lt;Box flexDirection=&quot;column&quot; /* ...styling... */&gt;</div>
<div class="line">        &lt;Text color=&quot;yellow&quot;&gt;Warning! Not in a git repo.&lt;/Text&gt;</div>
<div class="line">        &lt;ConfirmInput // &lt;-- An Ink component for Yes/No!</div>
<div class="line">          onConfirm={() =&gt; setAccepted(true)}</div>
<div class="line">          onCancel={() =&gt; app.exit()}</div>
<div class="line">        /&gt;</div>
<div class="line">      &lt;/Box&gt;</div>
<div class="line">    );</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  // Otherwise, render the main chat interface</div>
<div class="line">  return &lt;TerminalChat /* ...props... */ /&gt;;</div>
<div class="line">}</div>
</div><!-- fragment --><p>This snippet shows how the <code>App</code> component uses Ink's <code>&lt;Box&gt;</code>, <code>&lt;Text&gt;</code>, and even interactive components like <code>&lt;ConfirmInput&gt;</code>. If the safety check passes, it renders the core <code>&lt;TerminalChat&gt;</code> component.</p>
<p>The <code>&lt;TerminalChat&gt;</code> component (<code>terminal-chat.tsx</code>) is the main hub for the chat UI. It manages the state, like the list of messages (<code>items</code>), whether the AI is currently working (<code>loading</code>), and any command confirmations needed (<code>confirmationPrompt</code>).</p>
<div class="fragment"><div class="line">// File: codex-cli/src/components/chat/terminal-chat.tsx (Simplified)</div>
<div class="line"> </div>
<div class="line">// ... imports ...</div>
<div class="line">import TerminalMessageHistory from &quot;./terminal-message-history&quot;;</div>
<div class="line">import TerminalChatInput from &quot;./terminal-chat-input&quot;; // Or TerminalChatNewInput</div>
<div class="line">import { Box } from &quot;ink&quot;;</div>
<div class="line">import React, { useState } from &quot;react&quot;;</div>
<div class="line"> </div>
<div class="line">export default function TerminalChat({ /* ...props... */ }): React.ReactElement {</div>
<div class="line">  const [items, setItems] = useState&lt;Array&lt;ResponseItem&gt;&gt;([]); // Holds all messages</div>
<div class="line">  const [loading, setLoading] = useState&lt;boolean&gt;(false); // Is the AI busy?</div>
<div class="line">  const [confirmationPrompt, setConfirmationPrompt] = useState&lt;React.ReactNode | null&gt;(null); // Command to review?</div>
<div class="line">  // ... other state and logic ...</div>
<div class="line"> </div>
<div class="line">  return (</div>
<div class="line">    &lt;Box flexDirection=&quot;column&quot;&gt;</div>
<div class="line">      {/* Display the conversation history */}</div>
<div class="line">      &lt;TerminalMessageHistory</div>
<div class="line">        batch={/* ...derived from items... */}</div>
<div class="line">        loading={loading}</div>
<div class="line">        /* ...other props... */</div>
<div class="line">      /&gt;</div>
<div class="line"> </div>
<div class="line">      {/* Display the input box or the command review prompt */}</div>
<div class="line">      &lt;TerminalChatInput // Or TerminalChatNewInput</div>
<div class="line">        loading={loading}</div>
<div class="line">        confirmationPrompt={confirmationPrompt}</div>
<div class="line">        submitInput={(/*...user input...*/) =&gt; { /* Send to Agent Loop */ }}</div>
<div class="line">        submitConfirmation={(/*...decision...*/) =&gt; { /* Send to Agent Loop */ }}</div>
<div class="line">        /* ...other props... */</div>
<div class="line">      /&gt;</div>
<div class="line">    &lt;/Box&gt;</div>
<div class="line">  );</div>
<div class="line">}</div>
</div><!-- fragment --><ul>
<li><code>&lt;TerminalMessageHistory&gt;</code> takes the list of <code>items</code> (messages) and renders them.</li>
<li><code>&lt;TerminalChatInput&gt;</code> (or its multiline sibling <code>&lt;TerminalChatNewInput&gt;</code>) displays the input box when <code>loading</code> is false and there's no <code>confirmationPrompt</code>. If there <em>is</em> a <code>confirmationPrompt</code>, it shows the command review UI instead.</li>
</ul>
<h3><a class="anchor" id="autotoc_md1258"></a>
Showing Messages</h3>
<p>How does <code>&lt;TerminalMessageHistory&gt;</code> actually display the messages? It uses a special Ink component called <code>&lt;Static&gt;</code> for efficiency and maps each message <code>item</code> to a <code>&lt;TerminalChatResponseItem&gt;</code>.</p>
<div class="fragment"><div class="line">// File: codex-cli/src/components/chat/terminal-message-history.tsx (Simplified)</div>
<div class="line"> </div>
<div class="line">// ... imports ...</div>
<div class="line">import TerminalChatResponseItem from &quot;./terminal-chat-response-item&quot;;</div>
<div class="line">import { Box, Static } from &quot;ink&quot;;</div>
<div class="line">import React from &quot;react&quot;;</div>
<div class="line"> </div>
<div class="line">const MessageHistory: React.FC&lt;MessageHistoryProps&gt; = ({ batch, /* ... */ }) =&gt; {</div>
<div class="line">  // Extract the actual message objects</div>
<div class="line">  const messages = batch.map(({ item }) =&gt; item!);</div>
<div class="line"> </div>
<div class="line">  return (</div>
<div class="line">    &lt;Box flexDirection=&quot;column&quot;&gt;</div>
<div class="line">      {/* &lt;Static&gt; renders past items efficiently */}</div>
<div class="line">      &lt;Static items={messages}&gt;</div>
<div class="line">        {(message, index) =&gt; (</div>
<div class="line">          // Render each message using TerminalChatResponseItem</div>
<div class="line">          &lt;Box key={`${message.id}-${index}`} /* ...styling... */ &gt;</div>
<div class="line">            &lt;TerminalChatResponseItem item={message} /&gt;</div>
<div class="line">          &lt;/Box&gt;</div>
<div class="line">        )}</div>
<div class="line">      &lt;/Static&gt;</div>
<div class="line">    &lt;/Box&gt;</div>
<div class="line">  );</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">export default React.memo(MessageHistory);</div>
</div><!-- fragment --><p><code>&lt;Static&gt;</code> tells Ink that these items won't change often, allowing Ink to optimize rendering. Each message is passed to <code>&lt;TerminalChatResponseItem&gt;</code>.</p>
<p>Inside <code>TerminalChatResponseItem</code> (<code>terminal-chat-response-item.tsx</code>), we figure out what <em>kind</em> of message it is (user message, AI response, command output, etc.) and render it accordingly using Ink's basic <code>&lt;Text&gt;</code> and <code>&lt;Box&gt;</code> components, sometimes with helpers like <code>&lt;Markdown&gt;</code> for formatting.</p>
<div class="fragment"><div class="line">// File: codex-cli/src/components/chat/terminal-chat-response-item.tsx (Simplified)</div>
<div class="line"> </div>
<div class="line">// ... imports ...</div>
<div class="line">import { Box, Text } from &quot;ink&quot;;</div>
<div class="line">import React from &quot;react&quot;;</div>
<div class="line">// ... other components like Markdown ...</div>
<div class="line"> </div>
<div class="line">export default function TerminalChatResponseItem({ item }: { item: ResponseItem }): React.ReactElement {</div>
<div class="line">  switch (item.type) {</div>
<div class="line">    case &quot;message&quot;: // User or AI text message</div>
<div class="line">      return (</div>
<div class="line">        &lt;Box flexDirection=&quot;column&quot;&gt;</div>
<div class="line">          &lt;Text bold color={/* color based on role */}&gt;</div>
<div class="line">            {item.role === &quot;assistant&quot; ? &quot;codex&quot; : item.role}</div>
<div class="line">          &lt;/Text&gt;</div>
<div class="line">          {/* Render message content, potentially using Markdown */}</div>
<div class="line">          &lt;Text&gt;{/* ... content ... */}&lt;/Text&gt;</div>
<div class="line">        &lt;/Box&gt;</div>
<div class="line">      );</div>
<div class="line">    case &quot;function_call&quot;: // AI wants to run a command</div>
<div class="line">       return (</div>
<div class="line">         &lt;Box flexDirection=&quot;column&quot;&gt;</div>
<div class="line">           &lt;Text color=&quot;magentaBright&quot; bold&gt;command&lt;/Text&gt;</div>
<div class="line">           &lt;Text&gt;&lt;Text dimColor&gt;$&lt;/Text&gt; {/* Formatted command */}&lt;/Text&gt;</div>
<div class="line">         &lt;/Box&gt;</div>
<div class="line">       );</div>
<div class="line">    // ... other cases like function_call_output ...</div>
<div class="line">    default:</div>
<div class="line">      return &lt;Text&gt;Unknown message type&lt;/Text&gt;;</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md1259"></a>
Getting Your Input</h3>
<p>The <code>&lt;TerminalChatInput&gt;</code> (or <code>&lt;TerminalChatNewInput&gt;</code>) component uses specialized input components (like <code>&lt;TextInput&gt;</code> from <code>ink-text-input</code> or our custom <code>&lt;MultilineTextEditor&gt;</code>) to capture your keystrokes. When you press Enter, it calls the <code>onSubmit</code> or <code>submitInput</code> function provided by <code>&lt;TerminalChat&gt;</code>.</p>
<div class="fragment"><div class="line">// File: codex-cli/src/components/chat/terminal-chat-new-input.tsx (Simplified)</div>
<div class="line"> </div>
<div class="line">// ... imports ...</div>
<div class="line">import MultilineTextEditor from &quot;./multiline-editor&quot;; // Custom multiline input</div>
<div class="line">import { Box, Text, useInput } from &quot;ink&quot;;</div>
<div class="line">import React, { useState } from &quot;react&quot;;</div>
<div class="line"> </div>
<div class="line">export default function TerminalChatInput({ submitInput, active, /* ... */ }): React.ReactElement {</div>
<div class="line">  const [input, setInput] = useState(&quot;&quot;); // Current text in the editor</div>
<div class="line">  const editorRef = React.useRef(/* ... */); // Handle to editor</div>
<div class="line"> </div>
<div class="line">  // useInput hook from Ink handles key presses (like Up/Down for history)</div>
<div class="line">  useInput((_input, _key) =&gt; {</div>
<div class="line">     // Handle history navigation (Up/Down arrows)</div>
<div class="line">     // ... logic using editorRef.current.getRow() ...</div>
<div class="line">  }, { isActive: active });</div>
<div class="line"> </div>
<div class="line">  return (</div>
<div class="line">    &lt;Box flexDirection=&quot;column&quot;&gt;</div>
<div class="line">      &lt;Box borderStyle=&quot;round&quot;&gt;</div>
<div class="line">        {/* The actual input field */}</div>
<div class="line">        &lt;MultilineTextEditor</div>
<div class="line">          ref={editorRef}</div>
<div class="line">          onChange={(txt: string) =&gt; setInput(txt)}</div>
<div class="line">          initialText={input}</div>
<div class="line">          focus={active} // Only active when overlay isn&#39;t shown</div>
<div class="line">          onSubmit={(text) =&gt; {</div>
<div class="line">            // When Enter is pressed (and not escaped)</div>
<div class="line">            submitInput(/* ...create input item from text... */);</div>
<div class="line">            setInput(&quot;&quot;); // Clear the input field</div>
<div class="line">          }}</div>
<div class="line">        /&gt;</div>
<div class="line">      &lt;/Box&gt;</div>
<div class="line">      {/* Help text */}</div>
<div class="line">      &lt;Text dimColor&gt;ctrl+c to exit | enter to send&lt;/Text&gt;</div>
<div class="line">    &lt;/Box&gt;</div>
<div class="line">  );</div>
<div class="line">}</div>
</div><!-- fragment --><p>This component manages the text you type and uses Ink's <code>useInput</code> hook to handle special keys like arrow keys for command history. The details of text editing are handled in the next chapter: <a class="el" href="../../d3/dac/md__2github_2workspace_2ecosystem_2pocketflow_2docs_2Codex_202__input__handling____textbuffer__editor__.html">Input Handling (TextBuffer/Editor)</a>.</p>
<h3><a class="anchor" id="autotoc_md1260"></a>
Reviewing Commands</h3>
<p>If the <a class="el" href="../../d0/dbd/md__2github_2workspace_2ecosystem_2pocketflow_2docs_2Codex_203__agent__loop.html">Agent Loop</a> decides it needs to run a command and requires your approval, <code>&lt;TerminalChat&gt;</code> will receive a <code>confirmationPrompt</code>. This prompt (which is itself a React element, often <code>&lt;TerminalChatToolCallCommand&gt;</code>) is passed down to <code>&lt;TerminalChatInput&gt;</code>, which then renders <code>&lt;TerminalChatCommandReview&gt;</code> instead of the regular input box.</p>
<div class="fragment"><div class="line">// File: codex-cli/src/components/chat/terminal-chat-command-review.tsx (Simplified)</div>
<div class="line"> </div>
<div class="line">// ... imports ...</div>
<div class="line">// @ts-expect-error - Using a vendor component for selection</div>
<div class="line">import { Select } from &quot;../vendor/ink-select/select&quot;;</div>
<div class="line">import TextInput from &quot;../vendor/ink-text-input&quot;; // For editing feedback</div>
<div class="line">import { Box, Text, useInput } from &quot;ink&quot;;</div>
<div class="line">import React from &quot;react&quot;;</div>
<div class="line"> </div>
<div class="line">export function TerminalChatCommandReview({</div>
<div class="line">  confirmationPrompt, // The command display element</div>
<div class="line">  onReviewCommand, // Function to call with the decision</div>
<div class="line">}: { /* ... */ }): React.ReactElement {</div>
<div class="line">  const [mode, setMode] = React.useState&lt;&quot;select&quot; | &quot;input&quot;&gt;(&quot;select&quot;); // Select Yes/No or type feedback</div>
<div class="line"> </div>
<div class="line">  // Options for the selection list</div>
<div class="line">  const approvalOptions = [</div>
<div class="line">    { label: &quot;Yes (y)&quot;, value: ReviewDecision.YES },</div>
<div class="line">    // ... other options like Always, Edit, No ...</div>
<div class="line">  ];</div>
<div class="line"> </div>
<div class="line">  useInput((input, key) =&gt; { /* Handle shortcuts like &#39;y&#39;, &#39;n&#39;, &#39;e&#39;, Esc */ });</div>
<div class="line"> </div>
<div class="line">  return (</div>
<div class="line">    &lt;Box flexDirection=&quot;column&quot; borderStyle=&quot;round&quot; marginTop={1}&gt;</div>
<div class="line">      {/* Display the command that needs review */}</div>
<div class="line">      {confirmationPrompt}</div>
<div class="line"> </div>
<div class="line">      {mode === &quot;select&quot; ? (</div>
<div class="line">        &lt;&gt;</div>
<div class="line">          &lt;Text&gt;Allow command?&lt;/Text&gt;</div>
<div class="line">          &lt;Select // Ink component for selection lists</div>
<div class="line">            options={approvalOptions}</div>
<div class="line">            onChange={(value) =&gt; { /* ... call onReviewCommand or setMode(&#39;input&#39;) ... */ }}</div>
<div class="line">          /&gt;</div>
<div class="line">        &lt;/&gt;</div>
<div class="line">      ) : (</div>
<div class="line">        /* UI for typing feedback (TextInput) */</div>
<div class="line">        // ...</div>
<div class="line">      )}</div>
<div class="line">    &lt;/Box&gt;</div>
<div class="line">  );</div>
<div class="line">}</div>
</div><!-- fragment --><p>This component shows the command passed in (<code>confirmationPrompt</code>), presents options using Ink's <code>&lt;Select&gt;</code> component (or a <code>&lt;TextInput&gt;</code> if you choose to edit/give feedback), listens for your choice (via keyboard shortcuts or the selection list), and finally calls <code>onReviewCommand</code> with your decision.</p>
<h2><a class="anchor" id="autotoc_md1261"></a>
Under the Hood: How It All Connects</h2>
<p>Let's trace the flow from starting Codex to seeing an AI response:</p>
<div class="fragment"><div class="line">sequenceDiagram</div>
<div class="line">    participant User</div>
<div class="line">    participant Terminal</div>
<div class="line">    participant CodexCLI</div>
<div class="line">    participant InkReactApp as Ink/React UI</div>
<div class="line">    participant AgentLoop as Agent Loop</div>
<div class="line"> </div>
<div class="line">    User-&gt;&gt;Terminal: Runs `codex &quot;prompt&quot;`</div>
<div class="line">    Terminal-&gt;&gt;CodexCLI: Starts the process</div>
<div class="line">    CodexCLI-&gt;&gt;InkReactApp: Renders initial UI (`App` -&gt; `TerminalChat`)</div>
<div class="line">    InkReactApp-&gt;&gt;Terminal: Displays UI (header, empty chat, input box)</div>
<div class="line">    User-&gt;&gt;Terminal: Types message, presses Enter</div>
<div class="line">    Terminal-&gt;&gt;InkReactApp: Captures input (`TerminalChatInput`)</div>
<div class="line">    InkReactApp-&gt;&gt;AgentLoop: Sends user input via `submitInput` prop (in `TerminalChat`)</div>
<div class="line">    Note over AgentLoop: Processes input, calls LLM...</div>
<div class="line">    AgentLoop-&gt;&gt;InkReactApp: Sends back AI response via `onItem` prop (in `TerminalChat`)</div>
<div class="line">    InkReactApp-&gt;&gt;InkReactApp: Updates state (`items`), triggers re-render</div>
<div class="line">    InkReactApp-&gt;&gt;Terminal: Re-renders UI with new message (`MessageHistory`)</div>
</div><!-- fragment --><ol type="1">
<li>You run <code>codex</code>.</li>
<li>The CLI process starts.</li>
<li>The React application (<code>App</code> -&gt; <code>TerminalChat</code>) renders the initial UI using Ink components. Ink translates these components into terminal commands to draw the interface.</li>
<li>You type your message into the <code>&lt;TerminalChatInput&gt;</code> component.</li>
<li>When you press Enter, the input component's <code>onSubmit</code> handler is called.</li>
<li><code>&lt;TerminalChat&gt;</code> receives this, packages it, and calls the <code>run</code> method on the <a class="el" href="../../d0/dbd/md__2github_2workspace_2ecosystem_2pocketflow_2docs_2Codex_203__agent__loop.html">Agent Loop</a>.</li>
<li>The Agent Loop processes the input (often calling an LLM).</li>
<li>When the Agent Loop has something to display (like the AI's text response), it calls the <code>onItem</code> callback function provided by <code>&lt;TerminalChat&gt;</code>.</li>
<li><code>&lt;TerminalChat&gt;</code> receives the new message item and updates its <code>items</code> state using <code>setItems</code>.</li>
<li>React detects the state change and tells Ink to re-render the necessary components (like adding the new message to <code>&lt;TerminalMessageHistory&gt;</code>).</li>
<li>Ink updates the terminal display.</li>
</ol>
<p>The process for handling command confirmations is similar, involving the <code>getCommandConfirmation</code> and <code>submitConfirmation</code> callbacks between <code>&lt;TerminalChat&gt;</code> and the Agent Loop, rendering <code>&lt;TerminalChatCommandReview&gt;</code> in the UI when needed.</p>
<h2><a class="anchor" id="autotoc_md1262"></a>
Conclusion</h2>
<p>You've now seen how Codex uses the power of React and the Ink library to build a fully interactive chat interface directly within your terminal. This "Terminal UI" layer acts as the visual front-end, displaying messages, capturing your input, and presenting choices like command approvals, all while coordinating with the core <a class="el" href="../../d0/dbd/md__2github_2workspace_2ecosystem_2pocketflow_2docs_2Codex_203__agent__loop.html">Agent Loop</a> behind the scenes.</p>
<p>But how exactly does that input box capture your keystrokes, handle multi-line editing, and manage command history? We'll explore that in the next chapter.</p>
<p>Next up: <a class="el" href="../../d3/dac/md__2github_2workspace_2ecosystem_2pocketflow_2docs_2Codex_202__input__handling____textbuffer__editor__.html">Input Handling (TextBuffer/Editor)</a></p>
<hr  />
<p>Generated by <a href="https://github.com/The-Pocket/Tutorial-Codebase-Knowledge">AI Codebase Knowledge Builder</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
