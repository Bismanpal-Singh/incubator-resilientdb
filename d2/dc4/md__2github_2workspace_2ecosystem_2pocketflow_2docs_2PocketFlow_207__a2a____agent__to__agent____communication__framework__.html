#
# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
#  http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.
#
<!-- HTML header for doxygen 1.9.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ResilientDB: 07_a2a__agent_to_agent__communication_framework_</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen_html_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../logo.png"/></td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(1); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('d2/dc4/md__2github_2workspace_2ecosystem_2pocketflow_2docs_2PocketFlow_207__a2a____agent__to__agent____communication__framework__.html','../../'); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">07_a2a__agent_to_agent__communication_framework_</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="autotoc_md2773"></a>
autotoc_md2773</h2>
<p>layout: default title: "A2A (Agent-to-Agent) Communication Framework" parent: "PocketFlow" </p>
<h2><a class="anchor" id="autotoc_md2774"></a>
nav_order: 7</h2>
<h1><a class="anchor" id="autotoc_md2775"></a>
Chapter 7: A2A (Agent-to-Agent) Communication Framework</h1>
<p>Welcome to the final chapter of our PocketFlow journey! In <a class="el" href="../../d5/d89/md__2github_2workspace_2ecosystem_2pocketflow_2docs_2PocketFlow_206__batch__processing______batc450c527fc70ac874b2a5e6905704e4f6.html">Chapter 6: Batch Processing (<code>BatchNode</code>, <code>BatchFlow</code>, <code>AsyncParallelBatchNode</code>)</a>, we saw how to process multiple items or run workflows repeatedly. Now, we'll explore how to make your PocketFlow agents available to the wider world, allowing them to communicate with other systems or agents using a standard "language."</p>
<h2><a class="anchor" id="autotoc_md2776"></a>
The Challenge: Making Your Agent a Team Player</h2>
<p>Imagine you've built a fantastic PocketFlow agent that can research topics and answer questions. It's great for your own use, but what if:</p><ul>
<li>Another team in your company wants their AI system to ask questions of your agent?</li>
<li>You want to offer your agent's capabilities as a service that other applications can call?</li>
<li>You want to build a larger system composed of multiple specialized agents that need to collaborate?</li>
</ul>
<p>These scenarios require a <b>standardized way for agents to talk to each other</b>. Simply sharing Python code or relying on custom integrations isn't scalable or interoperable. This is where the <b>A2A (Agent-to-Agent) Communication Framework</b> comes in.</p>
<p><b>Our Use Case:</b> We want to take the PocketFlow-based research agent we've been conceptualizing (which uses <a class="el" href="../../dc/d55/md__2github_2workspace_2ecosystem_2pocketflow_2docs_2PocketFlow_202__node______basenode________node________asyncnode______.html">Nodes (<code>BaseNode</code>, <code>Node</code>, <code>AsyncNode</code>)</a> and a <a class="el" href="../../dd/de4/md__2github_2workspace_2ecosystem_2pocketflow_2docs_2PocketFlow_204__flow______flow________asyncflow______.html">Flow (<code>Flow</code>, <code>AsyncFlow</code>)</a>) and make it accessible via a standard A2A interface. Another program (a client) should be able to send it a question (e.g., "What is PocketFlow?") and receive an answer, all using this A2A standard.</p>
<p>The A2A framework in PocketFlow provides components that wrap your agent, allowing it to understand and speak the A2A JSON-RPC specification. Think of it like giving your agent a universal translator and a public phone line.</p>
<h2><a class="anchor" id="autotoc_md2777"></a>
Key Components of the A2A Framework</h2>
<p>The A2A framework in <code>PocketFlow</code> consists of a few main parts that work together:</p>
<ol type="1">
<li><b>A2A JSON-RPC Specification (The "Language")</b>: This isn't code, but a standard agreement on how agents communicate. It uses JSON-RPC, a lightweight remote procedure call protocol using JSON. It defines methods like <code>tasks/send</code> (to give an agent a job) and <code>tasks/get</code> (to check on a job), and the structure of messages. PocketFlow's A2A components adhere to this spec.<ul>
<li><b>Analogy</b>: If agents are from different countries, JSON-RPC is the agreed-upon common language (like Esperanto or English as a lingua franca) they'll use to talk.</li>
</ul>
</li>
<li><b>Common <code>types</code> (The "Vocabulary and Grammar")</b>: These are pre-defined Python Pydantic models (found in <code>cookbook/pocketflow-a2a/common/types.py</code>) that represent the structure of all A2A messages. This includes <code>Task</code>, <code>Message</code>, <code>Artifact</code>, <code>TextPart</code>, <code>JSONRPCRequest</code>, <code>JSONRPCResponse</code>, etc. Using these types ensures that both the client and server understand the format of the data being exchanged.<ul>
<li><b>Analogy</b>: These are the specific words and sentence structures within the agreed-upon language.</li>
</ul>
</li>
<li><b><code>A2AServer</code> (The "Receptionist")</b>: This component hosts your PocketFlow agent. It listens for incoming A2A requests over HTTP, understands the A2A JSON-RPC protocol, and passes the work to your agent (via the <code>TaskManager</code>).<ul>
<li><b>Analogy</b>: The <code>A2AServer</code> is like the public-facing receptionist for your PocketFlow agent. It answers the "phone" (HTTP requests) and speaks the standard A2A language.</li>
</ul>
</li>
<li><b><code>TaskManager</code> (The "Internal Translator")</b>: This is the crucial bridge. It receives instructions from the <code>A2AServer</code> (which are in the A2A format), translates them into something your PocketFlow Flow (<code>Flow</code>, <code>AsyncFlow</code>) can understand (typically by preparing the <a class="el" href="../../d1/d94/md__2github_2workspace_2ecosystem_2pocketflow_2docs_2PocketFlow_201__shared__state______shared____dictionary____.html">shared dictionary</a>), runs your PocketFlow Flow (<code>Flow</code>, <code>AsyncFlow</code>), and then takes the results from the <a class="el" href="../../d1/d94/md__2github_2workspace_2ecosystem_2pocketflow_2docs_2PocketFlow_201__shared__state______shared____dictionary____.html">shared dictionary</a> and packages them back into the A2A format for the <code>A2AServer</code> to send out.<ul>
<li><b>Analogy</b>: If your PocketFlow agent only speaks "PocketFlow-ese," the <code>TaskManager</code> is the internal assistant who translates A2A language from the receptionist into PocketFlow-ese and vice-versa.</li>
</ul>
</li>
<li><b><code>A2AClient</code> (The "Caller")</b>: This component allows you (or another system) to interact with an agent hosted by an <code>A2AServer</code>. It knows how to formulate A2A JSON-RPC requests and understand the responses.<ul>
<li><b>Analogy</b>: The <code>A2AClient</code> is someone using the public phone line to call your agent's receptionist.</li>
</ul>
</li>
</ol>
<p>Let's see how to use these to make our PocketFlow research agent accessible.</p>
<h2><a class="anchor" id="autotoc_md2778"></a>
Making Your PocketFlow Agent A2A-Compatible</h2>
<p>Let's assume you've already built your core PocketFlow agent using <a class="el" href="../../dc/d55/md__2github_2workspace_2ecosystem_2pocketflow_2docs_2PocketFlow_202__node______basenode________node________asyncnode______.html">Nodes (<code>BaseNode</code>, <code>Node</code>, <code>AsyncNode</code>)</a> and a <a class="el" href="../../dd/de4/md__2github_2workspace_2ecosystem_2pocketflow_2docs_2PocketFlow_204__flow______flow________asyncflow______.html">Flow (<code>Flow</code>, <code>AsyncFlow</code>)</a>, perhaps similar to the one in <code>cookbook/pocketflow-a2a/flow.py</code> that can take a question and produce an answer. The main function in <code><a class="el" href="../../d8/d10/flow_8py.html">flow.py</a></code> to get this flow is <code>create_agent_flow()</code>.</p>
<p><b>Step 1: Create Your <code>TaskManager</code></b></p>
<p>The <code>TaskManager</code> connects the A2A world to your PocketFlow <a class="el" href="../../dd/de4/md__2github_2workspace_2ecosystem_2pocketflow_2docs_2PocketFlow_204__flow______flow________asyncflow______.html">Flow (<code>Flow</code>, <code>AsyncFlow</code>)</a>. We'll create a <code>PocketFlowTaskManager</code> that inherits from a base <code>InMemoryTaskManager</code> (which handles storing task states).</p>
<p>Here's a simplified look at <code>PocketFlowTaskManager</code> from <code>cookbook/pocketflow-a2a/task_manager.py</code>:</p>
<div class="fragment"><div class="line"><span class="comment"># In task_manager.py</span></div>
<div class="line"><span class="keyword">from</span> common.server.task_manager <span class="keyword">import</span> InMemoryTaskManager</div>
<div class="line"><span class="keyword">from</span> common.types <span class="keyword">import</span> ( <span class="comment"># A2A standard message types</span></div>
<div class="line">    SendTaskRequest, SendTaskResponse, TaskState, TaskStatus,</div>
<div class="line">    TextPart, Artifact, Message</div>
<div class="line">)</div>
<div class="line"><span class="keyword">from</span> flow <span class="keyword">import</span> create_agent_flow <span class="comment"># Your PocketFlow agent logic</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>PocketFlowTaskManager(InMemoryTaskManager):</div>
<div class="line">    <span class="keyword">async def </span>on_send_task(self, request: SendTaskRequest) -&gt; SendTaskResponse:</div>
<div class="line">        <span class="comment"># 1. Get the question from the A2A request</span></div>
<div class="line">        query = self._get_user_query(request.params) <span class="comment"># Helper to extract text</span></div>
<div class="line">        <span class="keywordflow">if</span> <span class="keywordflow">not</span> query:</div>
<div class="line">            <span class="comment"># ... handle error: no query found ...</span></div>
<div class="line"> </div>
<div class="line">        <span class="comment"># 2. Prepare shared data for your PocketFlow agent</span></div>
<div class="line">        shared_data = {<span class="stringliteral">&quot;question&quot;</span>: query}</div>
<div class="line">        agent_flow = create_agent_flow() <span class="comment"># Get your PocketFlow flow</span></div>
<div class="line"> </div>
<div class="line">        <span class="comment"># 3. Run your PocketFlow agent</span></div>
<div class="line">        <span class="keywordflow">try</span>:</div>
<div class="line">            agent_flow.run(shared_data) <span class="comment"># This modifies shared_data</span></div>
<div class="line">            <span class="comment"># &#39;shared_data&#39; now contains the answer, e.g., shared_data[&quot;answer&quot;]</span></div>
<div class="line">        <span class="keywordflow">except</span> Exception <span class="keyword">as</span> e:</div>
<div class="line">            <span class="comment"># ... handle agent execution error ...</span></div>
<div class="line"> </div>
<div class="line">        <span class="comment"># 4. Package the result into A2A format</span></div>
<div class="line">        answer_text = shared_data.get(<span class="stringliteral">&quot;answer&quot;</span>, <span class="stringliteral">&quot;No answer.&quot;</span>)</div>
<div class="line">        final_status = TaskStatus(state=TaskState.COMPLETED)</div>
<div class="line">        final_artifact = Artifact(parts=[TextPart(text=answer_text)])</div>
<div class="line">        </div>
<div class="line">        <span class="comment"># Store final task details (InMemoryTaskManager helps here)</span></div>
<div class="line">        final_task = await self.update_store(</div>
<div class="line">            request.params.id, final_status, [final_artifact]</div>
<div class="line">        )</div>
<div class="line">        <span class="keywordflow">return</span> SendTaskResponse(id=request.id, result=final_task)</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">def </span>_get_user_query(self, task_params) -&gt; str | None:</div>
<div class="line">        <span class="comment"># Simplified: Extracts text from the A2A message parts</span></div>
<div class="line">        <span class="comment"># (Actual code in common/types.py &amp; task_manager.py is more robust)</span></div>
<div class="line">        <span class="keywordflow">if</span> task_params.message <span class="keywordflow">and</span> task_params.message.parts:</div>
<div class="line">            <span class="keywordflow">for</span> part <span class="keywordflow">in</span> task_params.message.parts:</div>
<div class="line">                <span class="keywordflow">if</span> part.type == <span class="stringliteral">&quot;text&quot;</span>: <span class="comment"># Assuming part is a Pydantic model</span></div>
<div class="line">                    <span class="keywordflow">return</span> part.text</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keywordtype">None</span></div>
</div><!-- fragment --><p> <b>Explanation:</b></p><ul>
<li><code>on_send_task</code>: This method is called when the <code>A2AServer</code> receives a <code>tasks/send</code> request.</li>
<li>It extracts the user's question from the A2A request's <code>message.parts</code> (using <code>_get_user_query</code>).</li>
<li>It prepares the <a class="el" href="../../d1/d94/md__2github_2workspace_2ecosystem_2pocketflow_2docs_2PocketFlow_201__shared__state______shared____dictionary____.html">shared dictionary</a> (<code>shared_data</code>) for your PocketFlow <a class="el" href="../../dd/de4/md__2github_2workspace_2ecosystem_2pocketflow_2docs_2PocketFlow_204__flow______flow________asyncflow______.html">Flow (<code>Flow</code>, <code>AsyncFlow</code>)</a>.</li>
<li>It runs your <code>agent_flow</code> with this <code>shared_data</code>. The <code>agent_flow</code> does its work and puts the answer back into <code>shared_data["answer"]</code>.</li>
<li>It retrieves the answer from <code>shared_data</code> and packages it into an A2A <code>Artifact</code> with a <code>TextPart</code>.</li>
<li>It updates the task's status to <code>COMPLETED</code> and returns an A2A <code>SendTaskResponse</code> containing the final <code>Task</code> object (which includes the answer artifact).</li>
</ul>
<p><b>Step 2: Set Up the <code>A2AServer</code></b></p>
<p>Now, we need to host our <code>PocketFlowTaskManager</code> using <code>A2AServer</code>. This involves defining an <code>AgentCard</code> (metadata about your agent) and starting the server.</p>
<p>A simplified <code>main</code> function from <code>cookbook/pocketflow-a2a/a2a_server.py</code>: </p><div class="fragment"><div class="line"><span class="comment"># In a2a_server.py</span></div>
<div class="line"><span class="keyword">from</span> common.server <span class="keyword">import</span> A2AServer</div>
<div class="line"><span class="keyword">from</span> common.types <span class="keyword">import</span> AgentCard, AgentCapabilities, AgentSkill <span class="comment"># For metadata</span></div>
<div class="line"><span class="keyword">from</span> task_manager <span class="keyword">import</span> PocketFlowTaskManager <span class="comment"># Your task manager</span></div>
<div class="line"><span class="keyword">import</span> os</div>
<div class="line"> </div>
<div class="line"><span class="keyword">def </span><a class="code hl_namespace" href="../../d2/dc1/namespacemain.html">main</a>(host=&quot;localhost&quot;, port=10003):</div>
<div class="line">    <span class="comment"># (Error checking for API keys like OPENAI_API_KEY happens here)</span></div>
<div class="line">    </div>
<div class="line">    <span class="comment"># 1. Define Agent&#39;s &quot;Business Card&quot; (AgentCard)</span></div>
<div class="line">    capabilities = AgentCapabilities(streaming=<span class="keyword">False</span>) <span class="comment"># Our agent isn&#39;t streaming</span></div>
<div class="line">    skill = AgentSkill(</div>
<div class="line">        id=<span class="stringliteral">&quot;web_research_qa&quot;</span>, name=<span class="stringliteral">&quot;Web Research and Answering&quot;</span>,</div>
<div class="line">        <span class="comment"># ... (more skill details: description, examples) ...</span></div>
<div class="line">        inputModes=[<span class="stringliteral">&quot;text&quot;</span>], outputModes=[<span class="stringliteral">&quot;text&quot;</span>]</div>
<div class="line">    )</div>
<div class="line">    agent_card = AgentCard(</div>
<div class="line">        name=<span class="stringliteral">&quot;PocketFlow Research Agent (A2A)&quot;</span>,</div>
<div class="line">        url=f<span class="stringliteral">&quot;http://{host}:{port}/&quot;</span>, <span class="comment"># Where clients connect</span></div>
<div class="line">        <span class="comment"># ... (more card details: description, version, skills) ...</span></div>
<div class="line">        capabilities=capabilities, skills=[skill]</div>
<div class="line">    )</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># 2. Initialize TaskManager and Server</span></div>
<div class="line">    task_manager = PocketFlowTaskManager()</div>
<div class="line">    server = A2AServer(</div>
<div class="line">        agent_card=agent_card,</div>
<div class="line">        task_manager=task_manager,</div>
<div class="line">        host=host, port=port,</div>
<div class="line">    )</div>
<div class="line"> </div>
<div class="line">    print(f<span class="stringliteral">&quot;Starting PocketFlow A2A server on http://{host}:{port}&quot;</span>)</div>
<div class="line">    server.start() <span class="comment"># This starts the HTTP server (e.g., Uvicorn)</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> __name__ == <span class="stringliteral">&quot;__main__&quot;</span>:</div>
<div class="line">    <span class="comment"># This would typically call main()</span></div>
<div class="line">    <span class="comment"># For example: main()</span></div>
<div class="line">    <span class="keywordflow">pass</span></div>
<div class="ttc" id="anamespacemain_html"><div class="ttname"><a href="../../d2/dc1/namespacemain.html">main</a></div><div class="ttdef"><b>Definition</b> <a href="../../dc/dba/main_8py_source.html#l00001">main.py:1</a></div></div>
</div><!-- fragment --><p> <b>Explanation:</b></p><ul>
<li><code>AgentCard</code>: This provides metadata about your agent (name, URL, capabilities, skills offered). Other A2A systems can fetch this card (from <code>/.well-known/agent.json</code>) to learn about your agent.</li>
<li>We instantiate our <code>PocketFlowTaskManager</code>.</li>
<li>We create an <code>A2AServer</code>, giving it the <code>agent_card</code>, our <code>task_manager</code>, and the <code>host</code>/<code>port</code> to listen on.</li>
<li><code>server.start()</code> launches the web server. Now your PocketFlow agent is listening for A2A requests!</li>
</ul>
<p><b>Step 3: Interact Using an <code>A2AClient</code></b></p>
<p>With the server running, other programs can now "call" your agent. The <code>A2AClient</code> helps with this.</p>
<p>A simplified CLI client from <code>cookbook/pocketflow-a2a/a2a_client.py</code>: </p><div class="fragment"><div class="line"><span class="comment"># In a2a_client.py</span></div>
<div class="line"><span class="keyword">import</span> asyncio</div>
<div class="line"><span class="keyword">from</span> common.client <span class="keyword">import</span> A2AClient <span class="comment"># The A2A client utility</span></div>
<div class="line"><span class="keyword">from</span> common.types <span class="keyword">import</span> TextPart <span class="comment"># To structure our question</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">async def </span>run_client(agent_url=&quot;http://localhost:10003<span class="stringliteral">&quot;):</span></div>
<div class="line"><span class="stringliteral">    client = A2AClient(url=agent_url)</span></div>
<div class="line"><span class="stringliteral">    </span></div>
<div class="line"><span class="stringliteral">    </span><span class="comment"># Get question from user</span></div>
<div class="line">    question_text = input(<span class="stringliteral">&quot;Enter your question: &quot;</span>)</div>
<div class="line">    <span class="keywordflow">if</span> <span class="keywordflow">not</span> question_text: <span class="keywordflow">return</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment"># 1. Prepare the A2A request payload (matches TaskSendParams)</span></div>
<div class="line">    <span class="comment"># This is a simplified representation of the common.types.TaskSendParams</span></div>
<div class="line">    payload = {</div>
<div class="line">        <span class="stringliteral">&quot;id&quot;</span>: <span class="stringliteral">&quot;some_unique_task_id&quot;</span>, <span class="comment"># Each task needs an ID</span></div>
<div class="line">        <span class="stringliteral">&quot;message&quot;</span>: {</div>
<div class="line">            <span class="stringliteral">&quot;role&quot;</span>: <span class="stringliteral">&quot;user&quot;</span>,</div>
<div class="line">            <span class="stringliteral">&quot;parts&quot;</span>: [{<span class="stringliteral">&quot;type&quot;</span>: <span class="stringliteral">&quot;text&quot;</span>, <span class="stringliteral">&quot;text&quot;</span>: question_text}], <span class="comment"># Our question</span></div>
<div class="line">        },</div>
<div class="line">        <span class="stringliteral">&quot;acceptedOutputModes&quot;</span>: [<span class="stringliteral">&quot;text&quot;</span>], <span class="comment"># We want text back</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    print(<span class="stringliteral">&quot;Sending task to agent...&quot;</span>)</div>
<div class="line">    <span class="keywordflow">try</span>:</div>
<div class="line">        <span class="comment"># 2. Send the task to the server</span></div>
<div class="line">        response = await client.send_task(payload) <span class="comment"># This makes the HTTP call</span></div>
<div class="line"> </div>
<div class="line">        <span class="comment"># 3. Process the response</span></div>
<div class="line">        <span class="keywordflow">if</span> response.error:</div>
<div class="line">            print(f<span class="stringliteral">&quot;Error from agent: {response.error.message}&quot;</span>)</div>
<div class="line">        <span class="keywordflow">elif</span> response.result <span class="keywordflow">and</span> response.result.artifacts:</div>
<div class="line">            <span class="comment"># Extract answer from the first text part of the first artifact</span></div>
<div class="line">            answer_part = response.result.artifacts[0].parts[0]</div>
<div class="line">            <span class="keywordflow">if</span> isinstance(answer_part, TextPart) <span class="keywordflow">or</span> answer_part.type == <span class="stringliteral">&quot;text&quot;</span>:</div>
<div class="line">                print(f<span class="stringliteral">&quot;Agent Answer: {answer_part.text}&quot;</span>)</div>
<div class="line">        <span class="keywordflow">else</span>:</div>
<div class="line">            print(<span class="stringliteral">&quot;Agent did not return a clear answer.&quot;</span>)</div>
<div class="line">            </div>
<div class="line">    <span class="keywordflow">except</span> Exception <span class="keyword">as</span> e:</div>
<div class="line">        print(f<span class="stringliteral">&quot;Client error: {e}&quot;</span>)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># To run this:</span></div>
<div class="line"><span class="comment"># if __name__ == &quot;__main__&quot;:</span></div>
<div class="line"><span class="comment"># asyncio.run(run_client())</span></div>
</div><!-- fragment --><p> <b>Explanation:</b></p><ul>
<li>An <code>A2AClient</code> is initialized with the server's URL.</li>
<li>A <code>payload</code> dictionary is created. This structure matches the A2A specification for sending a task (specifically, <code>TaskSendParams</code> from <code>common.types</code>). Our question is placed in <code>message.parts</code> as a <code>TextPart</code>.</li>
<li><code>client.send_task(payload)</code> sends the JSON-RPC request to the <code>A2AServer</code>.</li>
<li>The response (an A2A <code>Task</code> object) is processed. The answer is typically found in the <code>artifacts</code> of the <code>Task</code>.</li>
</ul>
<p><b>Example Interaction:</b></p><ol type="1">
<li>You run <code>a2a_server.py</code>. It starts listening on <code><a href="http://localhost:10003">http://localhost:10003</a></code>.</li>
<li>You run <code>a2a_client.py</code>.</li>
<li>Client prompts: <code>Enter your question:</code></li>
<li>You type: <code>What is PocketFlow?</code></li>
<li>Client sends this to the server.</li>
<li>Server (via <code>PocketFlowTaskManager</code> and your <code>agent_flow</code>) processes it.</li>
<li>Client receives the response and might print: <code>Agent Answer: PocketFlow is a minimalist LLM framework...</code></li>
</ol>
<p>Your PocketFlow agent is now communicating via a standard A2A interface!</p>
<h2><a class="anchor" id="autotoc_md2779"></a>
Under the Hood: The A2A Conversation Flow</h2>
<p>Let's trace a request from client to server and back:</p>
<ol type="1">
<li><b>Client Prepares</b>: The <code>A2AClient</code> takes your input (e.g., a question) and constructs a JSON object according to the A2A spec. This is a JSON-RPC request, often for the method <code>tasks/send</code>.<ul>
<li><code>A2AClient._send_request</code> (from <code>common/client/client.py</code>) assembles this. It uses <code>httpx</code> to make an HTTP POST request to the server's URL, with the JSON-RPC payload.</li>
</ul>
</li>
<li><b>Server Receives</b>: The <code>A2AServer</code> (built with Starlette) receives the HTTP POST request.<ul>
<li><code>A2AServer._process_request</code> (from <code>common/server/server.py</code>) handles this. It parses the JSON body into an <code>A2ARequest</code> Pydantic model (e.g., <code>SendTaskRequest</code>).</li>
</ul>
</li>
<li><b>Server Routes to TaskManager</b>: Based on the JSON-RPC method in the request (e.g., <code>tasks/send</code>), the <code>A2AServer</code> calls the corresponding method on your <code>TaskManager</code>.<ul>
<li>E.g., for <code>tasks/send</code>, it calls <code>task_manager.on_send_task(request_model)</code>.</li>
</ul>
</li>
<li><b>TaskManager -&gt; PocketFlow</b>: Your <code>PocketFlowTaskManager</code>'s <code>on_send_task</code> method:<ul>
<li>Extracts relevant data (like the question) from the <code>request_model</code>.</li>
<li>Prepares the <a class="el" href="../../d1/d94/md__2github_2workspace_2ecosystem_2pocketflow_2docs_2PocketFlow_201__shared__state______shared____dictionary____.html">shared dictionary</a> for your PocketFlow Flow (<code>Flow</code>, <code>AsyncFlow</code>).</li>
<li>Calls <code>your_pocketflow_flow.run(shared)</code>.</li>
</ul>
</li>
<li><b>PocketFlow Executes</b>: Your PocketFlow Flow (<code>Flow</code>, <code>AsyncFlow</code>) runs its Nodes (<code>BaseNode</code>, <code>Node</code>, <code>AsyncNode</code>), using and updating the <a class="el" href="../../d1/d94/md__2github_2workspace_2ecosystem_2pocketflow_2docs_2PocketFlow_201__shared__state______shared____dictionary____.html">shared dictionary</a>. The final answer is placed in <code>shared</code> (e.g., <code>shared["answer"]</code>).</li>
<li><b>PocketFlow -&gt; TaskManager</b>: Control returns to <code>PocketFlowTaskManager</code>. It:<ul>
<li>Retrieves the result (e.g., <code>shared["answer"]</code>).</li>
<li>Constructs an A2A <code>Task</code> object (from <code>common.types</code>), including <code>Artifacts</code> containing the answer.</li>
</ul>
</li>
<li><b>TaskManager -&gt; Server</b>: The <code>TaskManager</code> returns the populated <code>Task</code> object (wrapped in a <code>JSONRPCResponse</code> model) to the <code>A2AServer</code>.</li>
<li><b>Server Responds</b>: The <code>A2AServer</code> serializes the <code>JSONRPCResponse</code> (which contains the <code>Task</code> with the answer) back into a JSON string.<ul>
<li>It sends this JSON as the body of an HTTP 200 OK response back to the client.</li>
</ul>
</li>
<li><b>Client Processes</b>: The <code>A2AClient</code> receives the HTTP response.<ul>
<li>It parses the JSON body into its own Pydantic models (e.g., <code>SendTaskResponse</code> containing the <code>Task</code>).</li>
<li>It extracts the answer from the <code>Task</code>'s artifacts for you to see.</li>
</ul>
</li>
</ol>
<p>Here's a simplified sequence diagram of this interaction:</p>
<div class="fragment"><div class="line">sequenceDiagram</div>
<div class="line">    participant UserApp as User App (e.g., CLI)</div>
<div class="line">    participant Client as A2AClient</div>
<div class="line">    participant Server as A2AServer</div>
<div class="line">    participant TaskMgr as PocketFlowTaskManager</div>
<div class="line">    participant PF_Flow as Your PocketFlow Flow</div>
<div class="line"> </div>
<div class="line">    UserApp-&gt;&gt;Client: User provides question</div>
<div class="line">    Client-&gt;&gt;Server: HTTP POST / (JSON-RPC: tasks/send {question})</div>
<div class="line">    Server-&gt;&gt;TaskMgr: on_send_task(a2a_request_with_question)</div>
<div class="line">    TaskMgr-&gt;&gt;PF_Flow: flow.run(shared={&quot;question&quot;: ...})</div>
<div class="line">    Note over PF_Flow: Flow processes, puts answer in shared</div>
<div class="line">    PF_Flow--&gt;&gt;TaskMgr: Returns (shared modified with answer)</div>
<div class="line">    TaskMgr-&gt;&gt;TaskMgr: Creates A2A Task object with answer</div>
<div class="line">    TaskMgr--&gt;&gt;Server: Returns A2A Task object</div>
<div class="line">    Server--&gt;&gt;Client: HTTP 200 OK (JSON-RPC response {A2A Task with answer})</div>
<div class="line">    Client-&gt;&gt;UserApp: Displays answer from A2A Task</div>
</div><!-- fragment --><p><b>Key Code Snippets (Highly Simplified):</b></p>
<ul>
<li><b><code>A2AClient</code> sending request (from <code>common/client/client.py</code>):</b> <code>python @section autotoc_md2780 Inside A2AClient async def _send_request(self, request_model: JSONRPCRequest) -&gt; dict: @section autotoc_md2781 request_model is e.g., SendTaskRequest payload = request_model.model_dump(exclude_none=True) @section autotoc_md2782 self.fetchImpl is an httpx.AsyncClient http_response = await self.fetchImpl.post(self.url, json=payload) http_response.raise_for_status() # Check for HTTP errors return http_response.json() # Return parsed JSON response </code> This shows the client converting a Pydantic model to a dictionary (<code>payload</code>) and sending it via HTTP.</li>
<li><b><code>A2AServer</code> processing request (from <code>common/server/server.py</code>):</b> ```python </li>
</ul>
<h1><a class="anchor" id="autotoc_md2783"></a>
Inside A2AServer</h1>
<p>async def _process_request(self, http_request: Request): raw_body = await http_request.body() parsed_body = json.loads(raw_body) </p>
<h1><a class="anchor" id="autotoc_md2784"></a>
A2ARequest.validate_python converts dict to Pydantic model</h1>
<p>a2a_request_model = A2ARequest.validate_python(parsed_body)</p>
<p>if isinstance(a2a_request_model, SendTaskRequest): </p>
<h1><a class="anchor" id="autotoc_md2785"></a>
self.task_manager is your PocketFlowTaskManager</h1>
<p>result_model = await self.task_manager.on_send_task(a2a_request_model) </p>
<h1><a class="anchor" id="autotoc_md2786"></a>
... (other request types like GetTaskRequest) ...</h1>
<h1><a class="anchor" id="autotoc_md2787"></a>
result_model is e.g., SendTaskResponse</h1>
<p>return JSONResponse(result_model.model_dump(exclude_none=True)) ``<code> This shows the server parsing the incoming JSON, converting it to a Pydantic model, and calling the appropriate</code>TaskManager` method.</p>
<h2><a class="anchor" id="autotoc_md2788"></a>
Conclusion: Your Agent is Now a Global Citizen!</h2>
<p>You've reached the end of our PocketFlow tutorial series! With the <b>A2A (Agent-to-Agent) Communication Framework</b>, you've learned how to:</p><ul>
<li>Understand the roles of <code>A2AServer</code>, <code>A2AClient</code>, and <code>TaskManager</code>.</li>
<li>Wrap your existing PocketFlow Flows (<code>Flow</code>, <code>AsyncFlow</code>) with a <code>TaskManager</code> to handle A2A requests and responses.</li>
<li>Host your agent using <code>A2AServer</code>, making it accessible via a standard JSON-RPC interface.</li>
<li>Use <code>A2AClient</code> to interact with A2A-compatible agents.</li>
</ul>
<p>This framework transforms your PocketFlow agent from a standalone application into a component that can integrate with larger systems and collaborate with other agents, regardless of how they are built internally, as long as they speak the A2A language.</p>
<p><b>Reflecting on Your PocketFlow Journey:</b></p>
<p>Throughout this tutorial, you've explored the core concepts of PocketFlow:</p><ul>
<li>Managing data with the <a class="el" href="../../d1/d94/md__2github_2workspace_2ecosystem_2pocketflow_2docs_2PocketFlow_201__shared__state______shared____dictionary____.html">Shared State (<code>shared</code> dictionary)</a>.</li>
<li>Building modular tasks with <a class="el" href="../../dc/d55/md__2github_2workspace_2ecosystem_2pocketflow_2docs_2PocketFlow_202__node______basenode________node________asyncnode______.html">Nodes (<code>BaseNode</code>, <code>Node</code>, <code>AsyncNode</code>)</a>.</li>
<li>Creating dynamic workflows with <a class="el" href="../../d8/d3f/md__2github_2workspace_2ecosystem_2pocketflow_2docs_2PocketFlow_203__actions______transitions__.html">Actions / Transitions</a>.</li>
<li>Orchestrating nodes into powerful Flows (<code>Flow</code>, <code>AsyncFlow</code>).</li>
<li>Handling I/O-bound tasks efficiently with <a class="el" href="../../d7/d6d/md__2github_2workspace_2ecosystem_2pocketflow_2docs_2PocketFlow_205__asynchronous__processing___dbf1dc61cb3bcd98d46655d3ab8e2dd9.html">Asynchronous Processing (<code>AsyncNode</code>, <code>AsyncFlow</code>)</a>.</li>
<li>Processing collections of data using <a class="el" href="../../d5/d89/md__2github_2workspace_2ecosystem_2pocketflow_2docs_2PocketFlow_206__batch__processing______batc450c527fc70ac874b2a5e6905704e4f6.html">Batch Processing (<code>BatchNode</code>, <code>BatchFlow</code>, <code>AsyncParallelBatchNode</code>)</a>.</li>
<li>And finally, enabling standardized inter-agent communication with the A2A framework.</li>
</ul>
<p>You now have a solid foundation to build sophisticated, modular, and interoperable AI applications with PocketFlow. The world of intelligent agents awaits your creativity! Happy building!</p>
<hr  />
<p>Generated by <a href="https://github.com/The-Pocket/Tutorial-Codebase-Knowledge">AI Codebase Knowledge Builder</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
