#
# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
#  http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.
#
<!-- HTML header for doxygen 1.9.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ResilientDB: 06_fastmcp_context___context__</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen_html_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../logo.png"/></td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(1); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('d2/de0/md__2github_2workspace_2ecosystem_2pocketflow_2docs_2MCP_01Python_01SDK_206__fastmcp__context______context____.html','../../'); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">06_fastmcp_context___context__</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="autotoc_md2425"></a>
autotoc_md2425</h2>
<p>layout: default title: "FastMCP Context (Context)" parent: "MCP Python SDK" </p>
<h2><a class="anchor" id="autotoc_md2426"></a>
nav_order: 6</h2>
<h1><a class="anchor" id="autotoc_md2427"></a>
Chapter 6: Talking Back - FastMCP Context (<code>Context</code>)</h1>
<p>In <a class="el" href="../../d5/de9/md__2github_2workspace_2ecosystem_2pocketflow_2docs_2MCP_01Python_01SDK_205__fastmcp__prompts___e380d8fca08b641e7632fcc5814680b7.html">Chapter 5: Reusable Chat Starters - FastMCP Prompts (<code>Prompt</code>, <code>PromptManager</code>)</a>, we learned how to create reusable message templates for interacting with AI models. We've seen how to build servers with data resources (<a class="el" href="../../d9/dfc/md__2github_2workspace_2ecosystem_2pocketflow_2docs_2MCP_01Python_01SDK_203__fastmcp__resources_95757cc8f176683b04c22ceeac7ea1d5.html">Chapter 3</a>) and action tools (<a class="el" href="../../dc/df6/md__2github_2workspace_2ecosystem_2pocketflow_2docs_2MCP_01Python_01SDK_204__fastmcp__tools______tool________toolmanager____.html">Chapter 4</a>).</p>
<p>But imagine you have a tool that takes a while to run, like processing a large file or making a complex calculation. How does your tool communicate back to the user <em>while</em> it's running? How can it say "I'm 50% done!" or log important steps? Or what if a tool needs to read some data from one of the server's resources to do its job?</p>
<p>This is where the <b><code>Context</code></b> object comes in. It's like giving your tool function a temporary <b>backstage pass</b> for the specific request it's handling. This pass grants it access to special features like sending logs, reporting progress, or accessing other parts of the server environment related to that request.</p>
<h2><a class="anchor" id="autotoc_md2428"></a>
What is <code>Context</code>?</h2>
<p>The <code>Context</code> object is a special helper object provided by the <code>FastMCP</code> framework. If you define a tool function (or a resource function) that includes a parameter specifically typed as <code>Context</code>, <code>FastMCP</code> will automatically create and pass this object to your function when it's called.</p>
<p>Think of it this way:</p><ul>
<li>Each client request (like <code>callTool</code> or <code>readResource</code>) is like a separate event.</li>
<li>For that specific event, <code>FastMCP</code> can provide a <code>Context</code> object.</li>
<li>This <code>Context</code> object holds information about <em>that specific request</em> (like its unique ID).</li>
<li>It also provides methods (functions) to interact with the ongoing session, such as:<ul>
<li>Sending log messages back to the client (<code>ctx.info</code>, <code>ctx.debug</code>, etc.).</li>
<li>Reporting progress updates (<code>ctx.report_progress</code>).</li>
<li>Reading data from other resources defined on the server (<code>ctx.read_resource</code>).</li>
</ul>
</li>
</ul>
<p>It's your function's way of communicating out or accessing shared server capabilities during its execution for a particular request.</p>
<h2><a class="anchor" id="autotoc_md2429"></a>
Getting Access: Asking for the <code>Context</code></h2>
<p>How do you tell <code>FastMCP</code> that your function needs this backstage pass? You simply add a parameter to your function definition and use a <b>type hint</b> to mark it as <code>Context</code>.</p>
<p>Let's create a tool that simulates a long-running task and uses <code>Context</code> to report progress and log messages.</p>
<p><b>File: <code>long_task_server.py</code></b></p>
<div class="fragment"><div class="line"><span class="keyword">import</span> anyio <span class="comment"># For simulating delay with sleep</span></div>
<div class="line"><span class="keyword">from</span> mcp.server.fastmcp <span class="keyword">import</span> FastMCP</div>
<div class="line"><span class="comment"># 1. Import the Context type</span></div>
<div class="line"><span class="keyword">from</span> mcp.server.fastmcp.server <span class="keyword">import</span> Context</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Create the server instance</span></div>
<div class="line">server = FastMCP(name=<span class="stringliteral">&quot;LongTaskServer&quot;</span>)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Define our tool function</span></div>
<div class="line"><span class="comment"># 2. Add a parameter (e.g., &#39;ctx&#39;) and type hint it as &#39;Context&#39;</span></div>
<div class="line"><span class="preprocessor">@server.tool(name=&quot;long_task&quot;, description=&quot;Simulates a task that takes time.&quot;)</span></div>
<div class="line"><span class="keyword">async def </span>run_long_task(duration_seconds: int, ctx: Context) -&gt; str:</div>
<div class="line">  <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="stringliteral">  Simulates a task, reporting progress and logging using Context.</span></div>
<div class="line"><span class="stringliteral">  &quot;&quot;&quot;</span></div>
<div class="line">  <span class="comment"># 3. Use the context object!</span></div>
<div class="line">  await ctx.info(f<span class="stringliteral">&quot;Starting long task for {duration_seconds} seconds.&quot;</span>)</div>
<div class="line"> </div>
<div class="line">  total_steps = 5</div>
<div class="line">  <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(total_steps):</div>
<div class="line">      step = i + 1</div>
<div class="line">      await ctx.debug(f<span class="stringliteral">&quot;Working on step {step}/{total_steps}...&quot;</span>)</div>
<div class="line">      <span class="comment"># Simulate work</span></div>
<div class="line">      await anyio.sleep(duration_seconds / total_steps)</div>
<div class="line">      <span class="comment"># Report progress (current step, total steps)</span></div>
<div class="line">      await ctx.report_progress(step, total_steps)</div>
<div class="line"> </div>
<div class="line">  await ctx.info(<span class="stringliteral">&quot;Long task completed!&quot;</span>)</div>
<div class="line">  <span class="keywordflow">return</span> f<span class="stringliteral">&quot;Finished simulated task of {duration_seconds} seconds.&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment"># Standard run block</span></div>
<div class="line"><span class="keywordflow">if</span> __name__ == <span class="stringliteral">&quot;__main__&quot;</span>:</div>
<div class="line">    print(f<span class="stringliteral">&quot;Starting {server.name}...&quot;</span>)</div>
<div class="line">    server.run()</div>
<div class="line">    print(f<span class="stringliteral">&quot;{server.name} finished.&quot;</span>)</div>
</div><!-- fragment --><p><b>Explanation:</b></p>
<ol type="1">
<li><b><code>from mcp.server.fastmcp.server import Context</code></b>: We import the necessary <code>Context</code> class.</li>
<li><b><code>async def run_long_task(duration_seconds: int, ctx: Context)</code></b>:<ul>
<li>We define our tool function as usual.</li>
<li>Crucially, we add a parameter named <code>ctx</code>. You can name it anything (like <code>context</code>, <code>req_ctx</code>), but <code>ctx</code> is common.</li>
<li>We add the type hint <code>: Context</code> after the parameter name. This is the signal to <code>FastMCP</code> to inject the context object here.</li>
</ul>
</li>
<li><b>Using <code>ctx</code></b>: Inside the function, we can now use the methods provided by the <code>ctx</code> object:<ul>
<li><code>await ctx.info(...)</code>: Sends an informational log message back to the client connected to this session.</li>
<li><code>await ctx.debug(...)</code>: Sends a debug-level log message. There are also <code>warning</code> and <code>error</code> methods.</li>
<li><code>await ctx.report_progress(step, total_steps)</code>: Sends a progress update to the client. The client application might display this in a progress bar.</li>
</ul>
</li>
</ol>
<p>When a client calls the <code>long_task</code> tool, <code>FastMCP</code> will:</p><ol type="1">
<li>See the <code>ctx: Context</code> parameter.</li>
<li>Create a <code>Context</code> object specific to this request.</li>
<li>Call your <code>run_long_task</code> function, passing the duration and the newly created <code>ctx</code> object.</li>
<li>Your function runs, and calls like <code>ctx.info</code> or <code>ctx.report_progress</code> send messages back to the client <em>during</em> the execution of the tool.</li>
</ol>
<h2><a class="anchor" id="autotoc_md2430"></a>
Using <code>Context</code> to Access Resources</h2>
<p>The <code>Context</code> object isn't just for sending information <em>out</em>; it can also be used to access other parts of the server, like reading resources defined using <code>@server.resource</code>.</p>
<p>Let's modify our example. Imagine our long task needs some configuration data stored in a resource.</p>
<p><b>File: <code>long_task_server_with_resource.py</code></b></p>
<div class="fragment"><div class="line"><span class="keyword">import</span> anyio</div>
<div class="line"><span class="keyword">from</span> mcp.server.fastmcp <span class="keyword">import</span> FastMCP</div>
<div class="line"><span class="keyword">from</span> mcp.server.fastmcp.server <span class="keyword">import</span> Context</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Create the server instance</span></div>
<div class="line">server = FastMCP(name=<span class="stringliteral">&quot;LongTaskServer&quot;</span>)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Define a simple resource that holds some config data</span></div>
<div class="line"><span class="preprocessor">@server.resource(uri=&quot;config://task_settings&quot;, description=&quot;Settings for the long task.&quot;)</span></div>
<div class="line"><span class="keyword">def </span>get_task_settings() -&gt; str:</div>
<div class="line">  <span class="stringliteral">&quot;&quot;&quot;Returns task settings as a simple string.&quot;&quot;&quot;</span></div>
<div class="line">  <span class="comment"># In a real app, this might load from a file or database</span></div>
<div class="line">  print(<span class="stringliteral">&quot;Resource &#39;config://task_settings&#39; was read!&quot;</span>)</div>
<div class="line">  <span class="keywordflow">return</span> <span class="stringliteral">&quot;Default speed: Normal&quot;</span> <span class="comment"># Simple example setting</span></div>
<div class="line"> </div>
<div class="line"><span class="comment"># Define our tool function</span></div>
<div class="line"><span class="preprocessor">@server.tool(name=&quot;long_task&quot;, description=&quot;Simulates a task using config resource.&quot;)</span></div>
<div class="line"><span class="keyword">async def </span>run_long_task(duration_seconds: int, ctx: Context) -&gt; str:</div>
<div class="line">  <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="stringliteral">  Simulates a task, reads config via Context, reports progress.</span></div>
<div class="line"><span class="stringliteral">  &quot;&quot;&quot;</span></div>
<div class="line">  await ctx.info(f<span class="stringliteral">&quot;Starting long task for {duration_seconds} seconds.&quot;</span>)</div>
<div class="line"> </div>
<div class="line">  <span class="comment"># 1. Use context to read the resource</span></div>
<div class="line">  <span class="keywordflow">try</span>:</div>
<div class="line">      <span class="comment"># read_resource returns a list of content chunks</span></div>
<div class="line">      resource_contents = await ctx.read_resource(<span class="stringliteral">&quot;config://task_settings&quot;</span>)</div>
<div class="line">      <span class="comment"># Assuming simple text content for this example</span></div>
<div class="line">      settings = <span class="stringliteral">&quot;&quot;</span></div>
<div class="line">      <span class="keywordflow">for</span> content_part <span class="keywordflow">in</span> resource_contents:</div>
<div class="line">          <span class="keywordflow">if</span> hasattr(content_part, <span class="stringliteral">&#39;content&#39;</span>) <span class="keywordflow">and</span> isinstance(content_part.content, str):</div>
<div class="line">              settings = content_part.content</div>
<div class="line">              <span class="keywordflow">break</span></div>
<div class="line">      await ctx.info(f<span class="stringliteral">&quot;Loaded settings: {settings}&quot;</span>)</div>
<div class="line">  <span class="keywordflow">except</span> Exception <span class="keyword">as</span> e:</div>
<div class="line">      await ctx.warning(f<span class="stringliteral">&quot;Could not read task settings: {e}&quot;</span>)</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  total_steps = 5</div>
<div class="line">  <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(total_steps):</div>
<div class="line">      step = i + 1</div>
<div class="line">      await ctx.debug(f<span class="stringliteral">&quot;Working on step {step}/{total_steps}...&quot;</span>)</div>
<div class="line">      await anyio.sleep(duration_seconds / total_steps)</div>
<div class="line">      await ctx.report_progress(step, total_steps)</div>
<div class="line"> </div>
<div class="line">  await ctx.info(<span class="stringliteral">&quot;Long task completed!&quot;</span>)</div>
<div class="line">  <span class="keywordflow">return</span> f<span class="stringliteral">&quot;Finished simulated task of {duration_seconds} seconds using settings.&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment"># Standard run block</span></div>
<div class="line"><span class="keywordflow">if</span> __name__ == <span class="stringliteral">&quot;__main__&quot;</span>:</div>
<div class="line">    print(f<span class="stringliteral">&quot;Starting {server.name}...&quot;</span>)</div>
<div class="line">    server.run()</div>
<div class="line">    print(f<span class="stringliteral">&quot;{server.name} finished.&quot;</span>)</div>
</div><!-- fragment --><p><b>Explanation:</b></p>
<ol type="1">
<li>**<code>@server.resource(...)</code>**: We added a simple resource named <code>config://task_settings</code> that just returns a string.</li>
<li><b><code>resource_contents = await ctx.read_resource("config://task_settings")</code></b>: Inside our <code>run_long_task</code> tool, we now use <code>ctx.read_resource()</code> to fetch the content of our configuration resource. This allows the tool to dynamically access data managed by the server without having direct access to the resource's implementation function (<code>get_task_settings</code>).</li>
<li><b>Processing Content</b>: The <code>read_resource</code> method returns an iterable of <code>ReadResourceContents</code> objects (often just one). We extracted the string content to use it.</li>
</ol>
<p>Now, our tool can both communicate outwards (logs, progress) and interact inwards (read resources) using the same <code>Context</code> object, all within the scope of the single request it's handling.</p>
<h2><a class="anchor" id="autotoc_md2431"></a>
How <code>Context</code> Works Under the Hood</h2>
<p>It feels like magic that just adding <code>: Context</code> gives your function these powers, but it's a well-defined process within <code>FastMCP</code>.</p>
<ol type="1">
<li><b>Request Arrives:</b> A client sends a request, for example, <code>callTool</code> for our <code>long_task</code>.</li>
<li><b>Low-Level Handling:</b> The underlying <code>MCPServer</code> receives the request and creates a <code>RequestContext</code> object. This low-level context holds the raw request details, a reference to the current <code>ServerSession</code>, and the request ID.</li>
<li><b><code>FastMCP</code> Takes Over:</b> The request is routed to the appropriate <code>FastMCP</code> handler method (e.g., <code>FastMCP.call_tool</code>).</li>
<li><b>Context Creation:</b> Before calling the actual tool function, <code>FastMCP</code> calls its internal <code>get_context()</code> method. This method creates the high-level <code>Context</code> object we use. It wraps the low-level <code>RequestContext</code> and also adds a reference to the <code>FastMCP</code> server instance itself.</li>
<li><b>Function Inspection:</b> The <code>ToolManager</code> (when asked to run the tool) inspects the signature of your target function (<code>run_long_task</code>). It sees the <code>ctx: Context</code> parameter.</li>
<li><b>Injection:</b> The <code>ToolManager</code> (specifically the <code>Tool.run</code> method which uses <code>FuncMetadata.call_fn_with_arg_validation</code>) knows it needs to provide a <code>Context</code> object. It takes the <code>Context</code> created in step 4 and passes it as the argument for the <code>ctx</code> parameter when calling your <code>run_long_task</code> function.</li>
<li><b>Execution:</b> Your function runs. When you call <code>ctx.info("...")</code>, the <code>Context</code> object uses its reference to the underlying <code>RequestContext</code> and <code>ServerSession</code> to send the appropriate log message back to the client via the session. Similarly, <code>ctx.report_progress</code> uses the session, and <code>ctx.read_resource</code> uses the reference to the <code>FastMCP</code> instance to call its <code>read_resource</code> method.</li>
</ol>
<p><b>Simplified Sequence Diagram (<code>callTool</code> with <code>Context</code>):</b></p>
<div class="fragment"><div class="line">sequenceDiagram</div>
<div class="line">    participant Client</div>
<div class="line">    participant FastMCPServer as FastMCP (server.py)</div>
<div class="line">    participant ToolMgr as ToolManager (_tool_manager)</div>
<div class="line">    participant ToolRunner as Tool.run / FuncMetadata</div>
<div class="line">    participant YourToolFunc as run_long_task(ctx: Context)</div>
<div class="line">    participant ContextObj as Context</div>
<div class="line"> </div>
<div class="line">    Client-&gt;&gt;+FastMCPServer: callTool(name=&quot;long_task&quot;, args={...})</div>
<div class="line">    FastMCPServer-&gt;&gt;FastMCPServer: Create low-level RequestContext</div>
<div class="line">    FastMCPServer-&gt;&gt;+ContextObj: Create Context (wraps RequestContext, FastMCP)</div>
<div class="line">    FastMCPServer-&gt;&gt;+ToolMgr: call_tool(name=&quot;long_task&quot;, args={...})</div>
<div class="line">    ToolMgr-&gt;&gt;+ToolRunner: run(arguments={...}, context=ContextObj)</div>
<div class="line">    ToolRunner-&gt;&gt;ToolRunner: Inspect run_long_task, see &#39;ctx: Context&#39;</div>
<div class="line">    ToolRunner-&gt;&gt;+YourToolFunc: Call run_long_task(duration=..., ctx=ContextObj)</div>
<div class="line">    YourToolFunc-&gt;&gt;ContextObj: ctx.info(&quot;Starting...&quot;)</div>
<div class="line">    ContextObj-&gt;&gt;FastMCPServer: Use session.send_log_message(...)</div>
<div class="line">    YourToolFunc-&gt;&gt;ContextObj: ctx.report_progress(...)</div>
<div class="line">    ContextObj-&gt;&gt;FastMCPServer: Use session.send_progress_notification(...)</div>
<div class="line">    YourToolFunc-&gt;&gt;ContextObj: ctx.read_resource(&quot;config://...&quot;)</div>
<div class="line">    ContextObj-&gt;&gt;FastMCPServer: Call fastmcp.read_resource(&quot;config://...&quot;)</div>
<div class="line">    FastMCPServer--&gt;&gt;ContextObj: Return resource content</div>
<div class="line">    ContextObj--&gt;&gt;YourToolFunc: Return resource content</div>
<div class="line">    YourToolFunc--&gt;&gt;-ToolRunner: Return &quot;Finished...&quot;</div>
<div class="line">    ToolRunner--&gt;&gt;-ToolMgr: Return &quot;Finished...&quot;</div>
<div class="line">    ToolMgr--&gt;&gt;-FastMCPServer: Return &quot;Finished...&quot;</div>
<div class="line">    FastMCPServer-&gt;&gt;-Client: Send Response: result=&quot;Finished...&quot;</div>
</div><!-- fragment --><p><b>Looking at the Code (Briefly):</b></p>
<ul>
<li><p class="startli"><b>Context Creation (<code>server/fastmcp/server.py</code>)</b>: The <code>FastMCP.get_context</code> method is responsible for creating the <code>Context</code> object when needed, typically just before calling a tool or resource handler. It grabs the low-level context and wraps it.</p>
<p class="startli">```python </p>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md2432"></a>
Inside server/fastmcp/server.py (Simplified FastMCP.get_context)</h1>
<p>from mcp.shared.context import RequestContext # Low-level context</p>
<p>class FastMCP: </p>
<h1><a class="anchor" id="autotoc_md2433"></a>
... (other methods) ...</h1>
<p>def get_context(self) -&gt; Context[ServerSession, object]: """Returns a Context object.""" try: </p>
<h1><a class="anchor" id="autotoc_md2434"></a>
Get the low-level context for the current request</h1>
<p>request_context: RequestContext | None = self._mcp_server.request_context except LookupError: request_context = None # Not available outside a request</p>
<h1><a class="anchor" id="autotoc_md2435"></a>
Create our high-level Context, passing the low-level one</h1>
<h1><a class="anchor" id="autotoc_md2436"></a>
and a reference to this FastMCP instance ('self')</h1>
<p>return Context(request_context=request_context, fastmcp=self) ```</p>
<ul>
<li><p class="startli"><b>Context Injection (<code>server/fastmcp/tools/base.py</code>)</b>: The <code>Tool.from_function</code> method inspects the function signature to see if a <code>Context</code> parameter exists and stores its name (<code>context_kwarg</code>). Later, <code>Tool.run</code> uses this information (via <code>FuncMetadata</code>) to pass the context object when calling your function.</p>
<p class="startli">```python </p>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md2437"></a>
Inside server/fastmcp/tools/base.py (Simplified Tool.from_function)</h1>
<p>class Tool(BaseModel): </p>
<h1><a class="anchor" id="autotoc_md2438"></a>
... fields ...</h1>
<p>context_kwarg: str | None = Field(...)</p>
<p>@classmethod def from_function(cls, fn, ...) -&gt; Tool: </p>
<h1><a class="anchor" id="autotoc_md2439"></a>
... other inspection ...</h1>
<p>context_param_name = None sig = inspect.signature(fn) for param_name, param in sig.parameters.items(): </p>
<h1><a class="anchor" id="autotoc_md2440"></a>
Check if the type hint is Context</h1>
<p>if param.annotation is Context: context_param_name = param_name break </p>
<h1><a class="anchor" id="autotoc_md2441"></a>
... create FuncMetadata, skipping context arg ...</h1>
<p>return cls( </p>
<h1><a class="anchor" id="autotoc_md2442"></a>
...,</h1>
<p>context_kwarg=context_param_name, </p>
<h1><a class="anchor" id="autotoc_md2443"></a>
...</h1>
<p>)</p>
<h1><a class="anchor" id="autotoc_md2444"></a>
Inside Tool.run (simplified concept)</h1>
<p>async def run(self, arguments, context=None): </p>
<h1><a class="anchor" id="autotoc_md2445"></a>
... validate args ...</h1>
<p>kwargs_for_fn = validated_args if self.context_kwarg and context: </p>
<h1><a class="anchor" id="autotoc_md2446"></a>
Add the context object to the arguments passed to the function</h1>
<p>kwargs_for_fn[self.context_kwarg] = context</p>
<h1><a class="anchor" id="autotoc_md2447"></a>
Call the original function (self.fn)</h1>
<p>result = await self.fn(**kwargs_for_fn) # Or sync call return result ```</p>
<ul>
<li><p class="startli"><b>Context Implementation (<code>server/fastmcp/server.py</code>)</b>: The <code>Context</code> class itself implements methods like <code>info</code>, <code>report_progress</code>, <code>read_resource</code> by calling methods on the stored <code>_request_context.session</code> or <code>_fastmcp</code> instance.</p>
<p class="startli">```python </p>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md2448"></a>
Inside server/fastmcp/server.py (Simplified Context methods)</h1>
<p>class Context(BaseModel, Generic[ServerSessionT, LifespanContextT]): _request_context: RequestContext[...] | None _fastmcp: FastMCP | None </p>
<h1><a class="anchor" id="autotoc_md2449"></a>
... (init, properties) ...</h1>
<p>async def report_progress(self, progress, total=None): </p>
<h1><a class="anchor" id="autotoc_md2450"></a>
Get progress token from low-level context meta if available</h1>
<p>progress_token = self.request_context.meta.progressToken if self.request_context.meta else None if progress_token: </p>
<h1><a class="anchor" id="autotoc_md2451"></a>
Use the session object from the low-level context</h1>
<p>await self.request_context.session.send_progress_notification(...)</p>
<p>async def read_resource(self, uri): </p>
<h1><a class="anchor" id="autotoc_md2452"></a>
Use the stored FastMCP instance</h1>
<p>assert self._fastmcp is not None return await self._fastmcp.read_resource(uri)</p>
<p>async def log(self, level, message, ...): </p>
<h1><a class="anchor" id="autotoc_md2453"></a>
Use the session object from the low-level context</h1>
<p>await self.request_context.session.send_log_message(...)</p>
<p>async def info(self, message, **extra): await self.log("info", message, **extra) </p>
<h1><a class="anchor" id="autotoc_md2454"></a>
... (debug, warning, error methods) ...</h1>
<p>```</p>
<h2><a class="anchor" id="autotoc_md2455"></a>
Conclusion</h2>
<p>You've learned about the <code>Context</code> object in <code>FastMCP</code> â€“ your function's essential backstage pass during a request.</p>
<ul>
<li><code>Context</code> provides access to request-specific information and server capabilities.</li>
<li>You gain access by adding a parameter type-hinted as <code>Context</code> to your tool or resource function definition.</li>
<li>It allows your functions to:<ul>
<li>Send log messages (<code>ctx.info</code>, <code>ctx.debug</code>, etc.).</li>
<li>Report progress (<code>ctx.report_progress</code>).</li>
<li>Read server resources (<code>ctx.read_resource</code>).</li>
<li>Access request details (<code>ctx.request_id</code>).</li>
</ul>
</li>
<li><code>FastMCP</code> automatically creates and injects the <code>Context</code> object when your function is called for a specific request.</li>
</ul>
<p>The <code>Context</code> object is key to building more interactive and communicative tools and resources that can provide feedback to the user and interact with their environment during execution.</p>
<p>So far, we've focused on the high-level abstractions <code>FastMCP</code> provides (<code>Tool</code>, <code>Resource</code>, <code>Prompt</code>, <code>Context</code>). In the next chapter, we'll take a step back and look at the fundamental data structures defined by the MCP specification itself: <a class="el" href="../../de/dcd/md__2github_2workspace_2ecosystem_2pocketflow_2docs_2MCP_01Python_01SDK_207__mcp__protocol__types.html">Chapter 7: MCP Protocol Types</a>. Understanding these types helps clarify the data being exchanged between clients and servers under the hood.</p>
<hr  />
<p>Generated by <a href="https://github.com/The-Pocket/Tutorial-Codebase-Knowledge">AI Codebase Knowledge Builder</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
