#
# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
#  http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.
#
<!-- HTML header for doxygen 1.9.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ResilientDB: 06_multiarray_module</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen_html_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../logo.png"/></td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(1); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('db/d8b/md__2github_2workspace_2ecosystem_2pocketflow_2docs_2NumPy_01Core_206__multiarray__module.html','../../'); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">06_multiarray_module</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="autotoc_md2536"></a>
autotoc_md2536</h2>
<p>layout: default title: "Multiarray Module" parent: "NumPy Core" </p>
<h2><a class="anchor" id="autotoc_md2537"></a>
nav_order: 6</h2>
<h1><a class="anchor" id="autotoc_md2538"></a>
Chapter 6: multiarray Module</h1>
<p>Welcome back! In <a class="el" href="../../d8/d35/md__2github_2workspace_2ecosystem_2pocketflow_2docs_2NumPy_01Core_205__array__printing______arrayprint____.html">Chapter 5: Array Printing (<code>arrayprint</code>)</a>, we saw how NumPy takes complex arrays and presents them in a readable format. We've now covered the array container (<a class="el" href="../../de/d16/md__2github_2workspace_2ecosystem_2pocketflow_2docs_2NumPy_01Core_201__ndarray____n__dimensional__array__.html"><code>ndarray</code></a>), its data types (<a class="el" href="../../d6/d31/md__2github_2workspace_2ecosystem_2pocketflow_2docs_2NumPy_01Core_202__dtype____data__type__object__.html"><code>dtype</code></a>), the functions that compute on them (<a class="el" href="../../d6/def/md__2github_2workspace_2ecosystem_2pocketflow_2docs_2NumPy_01Core_203__ufunc____universal__function__.html"><code>ufunc</code></a>), the catalog of types (<a class="el" href="../../d4/d1f/md__2github_2workspace_2ecosystem_2pocketflow_2docs_2NumPy_01Core_204__numeric__types______numerictypes____.html"><code>numerictypes</code></a>), and how arrays are displayed (<a class="el" href="../../d8/d35/md__2github_2workspace_2ecosystem_2pocketflow_2docs_2NumPy_01Core_205__array__printing______arrayprint____.html"><code>arrayprint</code></a>).</p>
<p>Now, let's peek deeper into the engine room. Where does the fundamental <code>ndarray</code> object <em>actually</em> come from? How are core operations like creating arrays or accessing elements implemented so efficiently? The answer lies largely within the C code associated with the concept of the <code>multiarray</code> module.</p>
<h2><a class="anchor" id="autotoc_md2539"></a>
What Problem Does <code>multiarray</code> Solve? Providing the Engine</h2>
<p>Think about the very first step in using NumPy: creating an array.</p>
<div class="fragment"><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div>
<div class="line"> </div>
<div class="line"><span class="comment"># How does this seemingly simple line actually work?</span></div>
<div class="line">my_array = np.array([1, 2, 3, 4, 5])</div>
<div class="line"> </div>
<div class="line"><span class="comment"># How does NumPy know its shape? How is the data stored?</span></div>
<div class="line">print(my_array)</div>
<div class="line">print(my_array.shape)</div>
</div><!-- fragment --><p>When you execute <code>np.array()</code>, you're using a convenient Python function. But NumPy's speed doesn't come from Python itself. It comes from highly optimized code written in the C programming language. How do these Python functions connect to that fast C code? And where is that C code defined?</p>
<p>The <code>multiarray</code> concept represents this core C engine. It's the part of NumPy responsible for:</p>
<ol type="1">
<li><b>Defining the <code>ndarray</code> object:</b> The very structure that holds your data, its shape, its data type (<a class="el" href="../../d6/d31/md__2github_2workspace_2ecosystem_2pocketflow_2docs_2NumPy_01Core_202__dtype____data__type__object__.html"><code>dtype</code></a>), and how it's laid out in memory.</li>
<li><b>Implementing Fundamental Operations:</b> Providing the low-level C functions for creating arrays (like allocating memory), accessing elements (indexing), changing the view (slicing, reshaping), and basic mathematical operations.</li>
</ol>
<p>Think of the Python functions like <code>np.array</code>, <code>np.zeros</code>, or accessing <code>arr.shape</code> as the dashboard and controls of a car. The <code>multiarray</code> C code is the powerful engine under the hood that actually makes the car move efficiently.</p>
<h2><a class="anchor" id="autotoc_md2540"></a>
What is the <code>multiarray</code> Module (Concept)?</h2>
<p>Historically, <code>multiarray</code> was a distinct C extension module in NumPy. An "extension module" is a module written in C (or C++) that Python can import and use just like a regular Python module. This allows Python code to leverage the speed of C for performance-critical tasks.</p>
<p>More recently (since NumPy 1.16), the C code for <code>multiarray</code> was merged with the C code for the <a class="el" href="../../d6/def/md__2github_2workspace_2ecosystem_2pocketflow_2docs_2NumPy_01Core_203__ufunc____universal__function__.html">ufunc (Universal Function)</a> system (which we'll discuss more in <a class="el" href="../../d0/db5/md__2github_2workspace_2ecosystem_2pocketflow_2docs_2NumPy_01Core_207__umath__module.html">Chapter 7: umath Module</a>) into a single, larger C extension module typically called <code>_multiarray_umath.cpython-*.so</code> (on Linux/Mac) or <code>_multiarray_umath.pyd</code> (on Windows).</p>
<p>Even though the C code is merged, the <em>concept</em> of <code>multiarray</code> remains important. It represents the C implementation layer that provides:</p>
<ul>
<li>The <b><code>ndarray</code> object type</b> itself (<code>PyArrayObject</code> in C).</li>
<li>The <b>C-API (Application Programming Interface)</b>: A set of C functions that can be called by other C extensions (and internally by NumPy's Python code) to work with <code>ndarray</code> objects. Examples include functions to create arrays from data, get the shape, get the data pointer, perform indexing, etc.</li>
<li>Implementations of <b>core array functionalities</b>: array creation, data type handling (<a class="el" href="../../d6/d31/md__2github_2workspace_2ecosystem_2pocketflow_2docs_2NumPy_01Core_202__dtype____data__type__object__.html"><code>dtype</code></a>), memory layout management (strides), indexing, slicing, reshaping, transposing, and some basic operations.</li>
</ul>
<p>The Python files you might see in the NumPy source code, like <code>numpy/core/multiarray.py</code> and <code>numpy/core/numeric.py</code>, often serve as Python wrappers. They provide the user-friendly Python functions (like <code>np.array</code>, <code>np.empty</code>, <code>np.dot</code>) that eventually call the fast C functions implemented within the <code>_multiarray_umath</code> extension module.</p>
<div class="fragment"><div class="line"><span class="comment"># numpy/core/multiarray.py - Simplified Example</span></div>
<div class="line"><span class="comment"># This Python file imports directly from the C extension module</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">from</span> . <span class="keyword">import</span> _multiarray_umath <span class="comment"># Import the compiled C module</span></div>
<div class="line"><span class="keyword">from</span> ._multiarray_umath <span class="keyword">import</span> * <span class="comment"># Make C functions available</span></div>
<div class="line"> </div>
<div class="line"><span class="comment"># Functions like &#39;array&#39;, &#39;empty&#39;, &#39;dot&#39; that you use via `np.`</span></div>
<div class="line"><span class="comment"># might be defined or re-exported here, ultimately calling C code.</span></div>
<div class="line"><span class="comment"># For example, the `array` function here might parse the Python input</span></div>
<div class="line"><span class="comment"># and then call a C function like `PyArray_NewFromDescr` from _multiarray_umath.</span></div>
</div><!-- fragment --><p>This structure gives you the flexibility and ease of Python on the surface, powered by the speed and efficiency of C underneath.</p>
<h2><a class="anchor" id="autotoc_md2541"></a>
A Glimpse Under the Hood: Creating an Array</h2>
<p>Let's trace what happens when you call <code>my_array = np.array([1, 2, 3])</code>:</p>
<ol type="1">
<li><b>Python Call:</b> You call the Python function <code>np.array</code>. This function likely lives in <code>numpy/core/numeric.py</code> or is exposed through <code>numpy/core/multiarray.py</code>.</li>
<li><b>Argument Parsing:</b> The Python function examines the input <code>[1, 2, 3]</code>. It figures out the data type (likely <code>int64</code> by default on many systems) and the shape (which is <code>(3,)</code>).</li>
<li><b>Call C-API Function:</b> The Python function calls a specific function within the compiled <code>_multiarray_umath</code> C extension module. This C function is designed to create a new array. A common one is <code>PyArray_NewFromDescr</code> or a related helper.</li>
<li><b>Memory Allocation (C):</b> The C function asks the operating system for a block of memory large enough to hold 3 integers of the chosen type (e.g., 3 * 8 bytes = 24 bytes for <code>int64</code>).</li>
<li><b>Data Copying (C):</b> The C function copies the values <code>1</code>, <code>2</code>, and <code>3</code> from the Python list into the newly allocated memory block.</li>
<li><b>Create C <code>ndarray</code> Struct:</b> The C function creates an internal C structure (called <code>PyArrayObject</code>). This structure stores:<ul>
<li>A pointer to the actual data block in memory.</li>
<li>Information about the data type (<a class="el" href="../../d6/d31/md__2github_2workspace_2ecosystem_2pocketflow_2docs_2NumPy_01Core_202__dtype____data__type__object__.html"><code>dtype</code></a>).</li>
<li>The shape of the array (<code>(3,)</code>).</li>
<li>The strides (how many bytes to jump to get to the next element in each dimension).</li>
<li>Other metadata (like flags indicating if it owns the data, if it's writeable, etc.).</li>
</ul>
</li>
<li><b>Wrap in Python Object:</b> The C function wraps this internal <code>PyArrayObject</code> structure into a Python object that Python can understand â€“ the <code>ndarray</code> object you interact with.</li>
<li><b>Return to Python:</b> The C function returns this new Python <code>ndarray</code> object back to your Python code, which assigns it to the variable <code>my_array</code>.</li>
</ol>
<p>Here's a simplified view of that flow:</p>
<div class="fragment"><div class="line">sequenceDiagram</div>
<div class="line">    participant User as Your Python Script</div>
<div class="line">    participant PyFunc as NumPy Python Func (np.array)</div>
<div class="line">    participant C_API as C Code (_multiarray_umath)</div>
<div class="line">    participant Memory</div>
<div class="line"> </div>
<div class="line">    User-&gt;&gt;PyFunc: my_array = np.array([1, 2, 3])</div>
<div class="line">    PyFunc-&gt;&gt;C_API: Call C function (e.g., PyArray_NewFromDescr) with list data, inferred dtype, shape</div>
<div class="line">    C_API-&gt;&gt;Memory: Allocate memory block (e.g., 24 bytes for 3x int64)</div>
<div class="line">    C_API-&gt;&gt;Memory: Copy data [1, 2, 3] into block</div>
<div class="line">    C_API-&gt;&gt;C_API: Create internal C ndarray struct (PyArrayObject) pointing to data, storing shape=(3,), dtype=int64, etc.</div>
<div class="line">    C_API-&gt;&gt;PyFunc: Return Python ndarray object wrapping the C struct</div>
<div class="line">    PyFunc--&gt;&gt;User: Assign returned ndarray object to `my_array`</div>
</div><!-- fragment --><p><b>Where is the Code?</b></p>
<ul>
<li><b>C Implementation:</b> The core logic is in C files compiled into the <code>_multiarray_umath</code> extension module (e.g., parts of <code>numpy/core/src/multiarray/</code>). Files like <code>alloc.c</code>, <code>ctors.c</code> (constructors), <code>getset.c</code> (for getting/setting attributes like shape), <code>item_selection.c</code> (indexing) contain relevant C code.</li>
<li><b>Python Wrappers:</b> <code>numpy/core/numeric.py</code> and <code>numpy/core/multiarray.py</code> provide many of the familiar Python functions. They import directly from <code>_multiarray_umath</code>. <code>python @section autotoc_md2542 From numpy/core/numeric.py - Simplified from . import multiarray # Imports numpy/core/multiarray.py @section autotoc_md2543 multiarray.py itself imports from _multiarray_umath from .multiarray import ( array, asarray, zeros, empty, # Functions defined/re-exported @section autotoc_md2544 ... many others ... ) </code></li>
<li><b>Initialization:</b> <code>numpy/core/__init__.py</code> helps set up the <code>numpy.core</code> namespace, importing from <code>multiarray</code> and <code>umath</code>. <code>python @section autotoc_md2545 From numpy/core/__init__.py - Simplified from . import multiarray from . import umath @section autotoc_md2546 ... other imports ... from . import numeric from .numeric import * # Pulls in functions like np.array, np.zeros @section autotoc_md2547 ... more setup ... </code></li>
<li><b>C API Definition:</b> Files like <code>numpy/core/include/numpy/multiarray.h</code> define the C structures (<code>PyArrayObject</code>) and function prototypes (<code>PyArray_NewFromDescr</code>, etc.) that make up the NumPy C-API. Code generators like <code>numpy/core/code_generators/generate_numpy_api.py</code> help create tables (<code>__multiarray_api.h</code>, <code>__multiarray_api.c</code>) that allow other C extensions to easily access these core NumPy C functions. ```python </li>
</ul>
<h1><a class="anchor" id="autotoc_md2548"></a>
Snippet from numpy/core/code_generators/generate_numpy_api.py</h1>
<h1><a class="anchor" id="autotoc_md2549"></a>
This script generates C code that defines an array of function pointers</h1>
<h1><a class="anchor" id="autotoc_md2550"></a>
making up the C-API.</h1>
<h1><a class="anchor" id="autotoc_md2551"></a>
Describes API functions, their index in the API table, return type, args...</h1>
<p>multiarray_funcs = { </p>
<h1><a class="anchor" id="autotoc_md2552"></a>
... many functions ...</h1>
<p>'NewLikeArray': (10, None, 'PyObject *', (('PyArrayObject *', 'prototype'), ...)), 'NewFromDescr': (9, None, 'PyObject *', ...), 'Empty': (8, None, 'PyObject *', ...), </p>
<h1><a class="anchor" id="autotoc_md2553"></a>
...</h1>
<p>}</p>
<h1><a class="anchor" id="autotoc_md2554"></a>
... code to generate C header (.h) and implementation (.c) files ...</h1>
<h1><a class="anchor" id="autotoc_md2555"></a>
These generated files help expose the C functions consistently.</h1>
<p>```</p>
<h2><a class="anchor" id="autotoc_md2556"></a>
Conclusion</h2>
<p>You've now learned about the conceptual <code>multiarray</code> module, the C engine at the heart of NumPy.</p>
<ul>
<li>It's implemented in <b>C</b> (as part of the <code>_multiarray_umath</code> extension module) for maximum <b>speed and efficiency</b>.</li>
<li>It provides the fundamental <b><code>ndarray</code> object</b> structure.</li>
<li>It implements <b>core array operations</b> like creation, memory management, indexing, and reshaping at a low level.</li>
<li>Python modules like <code>numpy.core.numeric</code> and <code>numpy.core.multiarray</code> provide user-friendly interfaces that call this underlying C code.</li>
<li>Understanding this separation helps explain <em>why</em> NumPy is so fast compared to standard Python lists for numerical tasks.</li>
</ul>
<p>While <code>multiarray</code> provides the array structure and basic manipulation, the element-wise mathematical operations often rely on another closely related C implementation layer.</p>
<p>Let's explore that next in <a class="el" href="../../d0/db5/md__2github_2workspace_2ecosystem_2pocketflow_2docs_2NumPy_01Core_207__umath__module.html">Chapter 7: umath Module</a>.</p>
<hr  />
<p>Generated by <a href="https://github.com/The-Pocket/Tutorial-Codebase-Knowledge">AI Codebase Knowledge Builder</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
