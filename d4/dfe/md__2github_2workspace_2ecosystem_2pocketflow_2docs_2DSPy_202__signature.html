#
# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
#  http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.
#
<!-- HTML header for doxygen 1.9.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ResilientDB: 02_signature</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen_html_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../logo.png"/></td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(1); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('d4/dfe/md__2github_2workspace_2ecosystem_2pocketflow_2docs_2DSPy_202__signature.html','../../'); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">02_signature</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="autotoc_md1623"></a>
autotoc_md1623</h2>
<p>layout: default title: "Signature" parent: "DSPy" </p>
<h2><a class="anchor" id="autotoc_md1624"></a>
nav_order: 2</h2>
<h1><a class="anchor" id="autotoc_md1625"></a>
Chapter 2: Signatures - Defining the Task</h1>
<p>In <a class="el" href="../../d8/d9f/md__2github_2workspace_2ecosystem_2pocketflow_2docs_2DSPy_201__module______program.html">Chapter 1: Modules and Programs</a>, we learned that <code>Module</code>s are like Lego bricks that perform specific tasks, often using Language Models (<a class="el" href="../../d9/db7/md__2github_2workspace_2ecosystem_2pocketflow_2docs_2DSPy_205__lm____language__model__client__.html">LM</a>). We saw how <code>Program</code>s combine these modules.</p>
<p>But how does a <code>Module</code>, especially one using an LM like <code>dspy.Predict</code>, know <em>exactly</em> what job to do?</p>
<p>Imagine you ask a chef (our LM) to cook something. Just saying "cook" isn't enough! You need to tell them:</p><ol type="1">
<li><b>What ingredients to use</b> (the inputs).</li>
<li><b>What dish to make</b> (the outputs).</li>
<li><b>The recipe or instructions</b> (how to make it).</li>
</ol>
<p>This is precisely what a <b><code>Signature</code></b> does in DSPy!</p>
<p>A <code>Signature</code> acts like a clear recipe or contract for a DSPy <code>Module</code>. It defines:</p>
<ul>
<li><b>Input Fields:</b> What information the module needs to start its work.</li>
<li><b>Output Fields:</b> What information the module is expected to produce.</li>
<li><b>Instructions:</b> Natural language guidance (like a recipe!) telling the underlying LM <em>how</em> to transform the inputs into the outputs.</li>
</ul>
<p>Think of it as specifying the 'shape' and 'purpose' of a module, making sure everyone (you, DSPy, and the LM) understands the task.</p>
<h2><a class="anchor" id="autotoc_md1626"></a>
Why Do We Need Signatures?</h2>
<p>Without a clear definition, how would a module like <code>dspy.Predict</code> know what to ask the LM?</p>
<p>Let's say we want a module to translate English text to French. We need to tell it:</p><ul>
<li>It needs an <code>english_sentence</code> as input.</li>
<li>It should produce a <code>french_sentence</code> as output.</li>
<li>The <em>task</em> is to translate the input sentence into French.</li>
</ul>
<p>A <code>Signature</code> bundles all this information together neatly.</p>
<h2><a class="anchor" id="autotoc_md1627"></a>
Defining a Signature: The Recipe Card</h2>
<p>The most common way to define a Signature is by creating a Python class that inherits from <code>dspy.Signature</code>.</p>
<p>Let's create our English-to-French translation signature:</p>
<div class="fragment"><div class="line"><span class="keyword">import</span> dspy</div>
<div class="line"><span class="keyword">from</span> dspy.signatures.field <span class="keyword">import</span> InputField, OutputField</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>TranslateToFrench(dspy.Signature):</div>
<div class="line">    <span class="stringliteral">&quot;&quot;&quot;Translates English text to French.&quot;&quot;&quot;</span> <span class="comment"># &lt;-- These are the Instructions!</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment"># Define the Input Field the module expects</span></div>
<div class="line">    english_sentence = dspy.InputField(desc=<span class="stringliteral">&quot;The original sentence in English&quot;</span>)</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># Define the Output Field the module should produce</span></div>
<div class="line">    french_sentence = dspy.OutputField(desc=<span class="stringliteral">&quot;The translated sentence in French&quot;</span>)</div>
</div><!-- fragment --><p>Let's break this down:</p>
<ol type="1">
<li><b><code>class TranslateToFrench(dspy.Signature):</code></b>: We declare a new class named <code>TranslateToFrench</code> that inherits from <code>dspy.Signature</code>. This tells DSPy it's a signature definition.</li>
<li><b><code>"""Translates English text to French."""</code></b>: This is the <b>docstring</b>. It's crucial! DSPy uses this docstring as the natural language <b>Instructions</b> for the LM. It tells the LM the <em>goal</em> of the task.</li>
<li><b><code>english_sentence = dspy.InputField(...)</code></b>: We define an input field named <code>english_sentence</code>. <code>dspy.InputField</code> marks this as required input. The <code>desc</code> provides a helpful description (good for documentation and potentially useful for the LM later).</li>
<li><b><code>french_sentence = dspy.OutputField(...)</code></b>: We define an output field named <code>french_sentence</code>. <code>dspy.OutputField</code> marks this as the expected output. The <code>desc</code> describes what this field should contain.</li>
</ol>
<p>That's it! We've created a reusable "recipe card" that clearly defines our translation task.</p>
<h2><a class="anchor" id="autotoc_md1628"></a>
How Modules Use Signatures</h2>
<p>Now, how does a <code>Module</code> like <code>dspy.Predict</code> use this <code>TranslateToFrench</code> signature?</p>
<p><code>dspy.Predict</code> is a pre-built module designed to take a signature and use an LM to generate the output fields based on the input fields and instructions.</p>
<p>Here's how you might use our signature with <code>dspy.Predict</code> (we'll cover <code>dspy.Predict</code> in detail in <a class="el" href="../../d5/d3c/md__2github_2workspace_2ecosystem_2pocketflow_2docs_2DSPy_204__predict.html">Chapter 4</a>):</p>
<div class="fragment"><div class="line"><span class="comment"># Assume &#39;lm&#39; is a configured Language Model client (more in Chapter 5)</span></div>
<div class="line"><span class="comment"># lm = dspy.OpenAI(model=&#39;gpt-3.5-turbo&#39;)</span></div>
<div class="line"><span class="comment"># dspy.settings.configure(lm=lm)</span></div>
<div class="line"> </div>
<div class="line"><span class="comment"># Create an instance of dspy.Predict, giving it our Signature</span></div>
<div class="line">translator = dspy.Predict(TranslateToFrench)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Call the predictor with the required input field</span></div>
<div class="line">english = <span class="stringliteral">&quot;Hello, how are you?&quot;</span></div>
<div class="line">result = translator(english_sentence=english)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># The result object will contain the output field defined in the signature</span></div>
<div class="line">print(f<span class="stringliteral">&quot;English: {english}&quot;</span>)</div>
<div class="line"><span class="comment"># Assuming the LM works correctly, it might print:</span></div>
<div class="line"><span class="comment"># print(f&quot;French: {result.french_sentence}&quot;) # =&gt; French: Bonjour, comment Ã§a va?</span></div>
</div><!-- fragment --><p>In this (slightly simplified) example:</p>
<ol type="1">
<li><code>translator = dspy.Predict(TranslateToFrench)</code>: We create a <code>Predict</code> module. Crucially, we pass our <code>TranslateToFrench</code> <b>class</b> itself to it. <code>dspy.Predict</code> now knows the input/output fields and the instructions from the signature.</li>
<li><code>result = translator(english_sentence=english)</code>: When we call the <code>translator</code>, we provide the input data using the exact name defined in our signature (<code>english_sentence</code>).</li>
<li><code>result.french_sentence</code>: <code>dspy.Predict</code> uses the LM, guided by the signature's instructions and fields, to generate the output. It then returns an object where you can access the generated French text using the output field name (<code>french_sentence</code>).</li>
</ol>
<p>The <code>Signature</code> acts as the bridge, ensuring the <code>Predict</code> module knows its job specification.</p>
<h2><a class="anchor" id="autotoc_md1629"></a>
How It Works Under the Hood (A Peek)</h2>
<p>You don't need to memorize this, but understanding the flow helps! When a module like <code>dspy.Predict</code> uses a <code>Signature</code>:</p>
<ol type="1">
<li><b>Inspection:</b> The module looks at the <code>Signature</code> class (<code>TranslateToFrench</code> in our case).</li>
<li><b>Extract Info:</b> It identifies the <code>InputField</code>s (<code>english_sentence</code>), <code>OutputField</code>s (<code>french_sentence</code>), and the <code>Instructions</code> (the docstring: <code>"Translates English text to French."</code>).</li>
<li><b>Prompt Formatting:</b> When you call the module (e.g., <code>translator(english_sentence="Hello")</code>), it uses this information to build a prompt for the <a class="el" href="../../d9/db7/md__2github_2workspace_2ecosystem_2pocketflow_2docs_2DSPy_205__lm____language__model__client__.html">LM</a>. This prompt typically includes:<ul>
<li>The <b>Instructions</b>.</li>
<li>Clearly labeled <b>Input Fields</b> and their values.</li>
<li>Clearly labeled <b>Output Fields</b> (often just the names, indicating what the LM should generate).</li>
</ul>
</li>
<li><b>LM Call:</b> The formatted prompt is sent to the configured LM.</li>
<li><b>Parsing Output:</b> The LM's response is received. DSPy tries to parse this response to extract the values for the defined <code>OutputField</code>s (like <code>french_sentence</code>).</li>
<li><b>Return Result:</b> A structured result object containing the parsed outputs is returned.</li>
</ol>
<p>Let's visualize this flow:</p>
<div class="fragment"><div class="line">sequenceDiagram</div>
<div class="line">    participant User</div>
<div class="line">    participant PredictModule as dspy.Predict(TranslateToFrench)</div>
<div class="line">    participant Signature as TranslateToFrench</div>
<div class="line">    participant LM as Language Model</div>
<div class="line"> </div>
<div class="line">    User-&gt;&gt;PredictModule: Call with english_sentence=&quot;Hello&quot;</div>
<div class="line">    PredictModule-&gt;&gt;Signature: Get Instructions, Input/Output Fields</div>
<div class="line">    Signature--&gt;&gt;PredictModule: Return structure (&quot;Translates...&quot;, &quot;english_sentence&quot;, &quot;french_sentence&quot;)</div>
<div class="line">    PredictModule-&gt;&gt;LM: Send formatted prompt (e.g., &quot;Translate...\nEnglish: Hello\nFrench:&quot;)</div>
<div class="line">    LM--&gt;&gt;PredictModule: Return generated text (e.g., &quot;Bonjour&quot;)</div>
<div class="line">    PredictModule-&gt;&gt;Signature: Parse LM output into &#39;french_sentence&#39; field</div>
<div class="line">    Signature--&gt;&gt;PredictModule: Return structured output {french_sentence: &quot;Bonjour&quot;}</div>
<div class="line">    PredictModule--&gt;&gt;User: Return structured output (Prediction object)</div>
</div><!-- fragment --><p>The core logic for defining signatures resides in:</p>
<ul>
<li><code>dspy/signatures/signature.py</code>: Defines the base <code>Signature</code> class and the logic for handling instructions and fields.</li>
<li><code>dspy/signatures/field.py</code>: Defines <code>InputField</code> and <code>OutputField</code>.</li>
</ul>
<p>Modules like <code>dspy.Predict</code> (in <code>dspy/predict/predict.py</code>) contain the code to <em>read</em> these Signatures and interact with LMs accordingly.</p>
<div class="fragment"><div class="line"><span class="comment"># Simplified view inside dspy/signatures/signature.py</span></div>
<div class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</div>
<div class="line"><span class="keyword">from</span> pydantic.fields <span class="keyword">import</span> FieldInfo</div>
<div class="line"><span class="comment"># ... other imports ...</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>SignatureMeta(type(BaseModel)):</div>
<div class="line">    <span class="comment"># Metaclass magic to handle fields and docstring</span></div>
<div class="line">    <span class="keyword">def </span>__new__(mcs, name, bases, namespace, **kwargs):</div>
<div class="line">        <span class="comment"># ... logic to find fields, handle docstring ...</span></div>
<div class="line">        cls = super().__new__(mcs, name, bases, namespace, **kwargs)</div>
<div class="line">        cls.__doc__ = cls.__doc__ <span class="keywordflow">or</span> _default_instructions(cls) <span class="comment"># Default instructions if none provided</span></div>
<div class="line">        <span class="comment"># ... logic to validate fields ...</span></div>
<div class="line">        <span class="keywordflow">return</span> cls</div>
<div class="line"> </div>
<div class="line">    <span class="preprocessor">@property</span></div>
<div class="line">    <span class="keyword">def </span>instructions(cls) -&gt; str:</div>
<div class="line">        <span class="comment"># Retrieves the docstring as instructions</span></div>
<div class="line">        <span class="keywordflow">return</span> inspect.cleandoc(getattr(cls, <span class="stringliteral">&quot;__doc__&quot;</span>, <span class="stringliteral">&quot;&quot;</span>))</div>
<div class="line"> </div>
<div class="line">    <span class="preprocessor">@property</span></div>
<div class="line">    <span class="keyword">def </span>input_fields(cls) -&gt; dict[str, FieldInfo]:</div>
<div class="line">        <span class="comment"># Finds fields marked as input</span></div>
<div class="line">        <span class="keywordflow">return</span> cls._get_fields_with_type(<span class="stringliteral">&quot;input&quot;</span>)</div>
<div class="line"> </div>
<div class="line">    <span class="preprocessor">@property</span></div>
<div class="line">    <span class="keyword">def </span>output_fields(cls) -&gt; dict[str, FieldInfo]:</div>
<div class="line">        <span class="comment"># Finds fields marked as output</span></div>
<div class="line">        <span class="keywordflow">return</span> cls._get_fields_with_type(<span class="stringliteral">&quot;output&quot;</span>)</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>Signature(BaseModel, metaclass=SignatureMeta):</div>
<div class="line">    <span class="comment"># The base class you inherit from</span></div>
<div class="line">    <span class="keywordflow">pass</span></div>
<div class="line"> </div>
<div class="line"><span class="comment"># Simplified view inside dspy/signatures/field.py</span></div>
<div class="line"><span class="keyword">import</span> pydantic</div>
<div class="line"> </div>
<div class="line"><span class="keyword">def </span>InputField(**kwargs):</div>
<div class="line">    <span class="comment"># Creates a Pydantic field marked as input for DSPy</span></div>
<div class="line">    <span class="keywordflow">return</span> pydantic.Field(**move_kwargs(**kwargs, __dspy_field_type=<span class="stringliteral">&quot;input&quot;</span>))</div>
<div class="line"> </div>
<div class="line"><span class="keyword">def </span>OutputField(**kwargs):</div>
<div class="line">    <span class="comment"># Creates a Pydantic field marked as output for DSPy</span></div>
<div class="line">    <span class="keywordflow">return</span> pydantic.Field(**move_kwargs(**kwargs, __dspy_field_type=<span class="stringliteral">&quot;output&quot;</span>))</div>
</div><!-- fragment --><p>The key takeaway is that the <code>Signature</code> class structure (using <code>InputField</code>, <code>OutputField</code>, and the docstring) provides a standardized way for modules to understand the task specification.</p>
<h2><a class="anchor" id="autotoc_md1630"></a>
Conclusion</h2>
<p>You've now learned about <code>Signatures</code>, the essential component for defining <em>what</em> a DSPy module should do!</p>
<ul>
<li>A <code>Signature</code> specifies the <b>Inputs</b>, <b>Outputs</b>, and <b>Instructions</b> for a task.</li>
<li>It acts like a contract or recipe card for modules, especially those using LMs.</li>
<li>You typically define them by subclassing <code>dspy.Signature</code>, using <code>InputField</code>, <code>OutputField</code>, and a descriptive <b>docstring</b> for instructions.</li>
<li>Modules like <code>dspy.Predict</code> use Signatures to understand the task and generate appropriate prompts for the LM.</li>
</ul>
<p>Signatures bring clarity and structure to LM interactions. But how do we provide concrete examples to help the LM learn or perform better? That's where <code>Examples</code> come in!</p>
<p><b>Next:</b> <a class="el" href="../../dc/db9/md__2github_2workspace_2ecosystem_2pocketflow_2docs_2DSPy_203__example.html">Chapter 3: Example</a></p>
<hr  />
<p>Generated by <a href="https://github.com/The-Pocket/Tutorial-Codebase-Knowledge">AI Codebase Knowledge Builder</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
